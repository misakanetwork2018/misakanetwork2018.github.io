(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[38],{"2a1a":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{staticClass:"flex flex-center"},[n("div",{staticClass:"auth-form"},[n("h4",[e._v("注册")]),n("q-form",{staticClass:"q-gutter-md",on:{submit:e.onSubmit}},[n("q-input",{ref:"username",attrs:{filled:"",label:"用户名","lazy-rules":"",rules:[function(e){return e&&e.length>0||"请输入用户名"},function(t){return!e.username_exist||"用户名已被占用"}]},on:{input:function(t){e.username_exist=!1}},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),n("q-input",{attrs:{filled:"",type:"password",label:"密码","lazy-rules":"",rules:[function(e){return e&&e.length>=6&&e.length<=30||"请输入6-30位密码"}]},on:{input:function(t){!e.password_confirm||e.$refs.confirm.validate()}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),n("q-input",{ref:"confirm",attrs:{filled:"",type:"password",label:"确认密码","lazy-rules":"",rules:[function(e){return e&&e.length>0||"请输入确认密码"},function(t){return e.passwordConfirm||"密码与确认密码不相符"}]},model:{value:e.password_confirm,callback:function(t){e.password_confirm=t},expression:"password_confirm"}}),n("q-input",{ref:"email",attrs:{filled:"",label:"邮箱","lazy-rules":"",rules:[function(e){return e&&e.length>0||"请输入邮箱"},function(t){return e.isEmail||"必须符合邮箱格式"},function(t){return!e.email_exist||"邮箱已被占用"}]},on:{input:function(t){e.email_exist=!1}},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),n("q-input",{ref:"inviteCode",attrs:{filled:"",label:"邀请码"+(e.needInviteCode?"":"(可选)"),"lazy-rules":"",rules:[function(t){return!e.needInviteCode||t&&t.length>0||"请输入邀请码"},function(t){return e.invite_code_exist||"邀请码不存在"}]},on:{input:function(t){e.invite_code_exist=!0}},model:{value:e.invite_code,callback:function(t){e.invite_code=t},expression:"invite_code"}}),e.needV2?n("vue-recaptcha",{attrs:{sitekey:e.v2_key,loadRecaptchaScript:!0,recaptchaHost:"www.recaptcha.net"},on:{verify:e.onCaptchaVerify}}):e._e(),n("recaptcha-js-v3"),n("div",[n("q-btn",{attrs:{label:"注册",type:"submit",color:"primary",loading:e.doing,disable:e.doing}}),n("q-btn",{staticClass:"q-ml-sm",attrs:{label:"返回登录",color:"primary",flat:"",to:"/login"}})],1)],1)],1)])},i=[],s=(n("3b2b"),n("e096")),r={data:function(){return{username:"",password:"",password_confirm:"",email:"",invite_code:"",needV2:!1,recaptcha_v2:null,username_exist:!1,email_exist:!1,invite_code_exist:!0,doing:!1,needInviteCode:!0}},created:function(){var e=this;this.$axios.get("/config/allowRegister").then((function(t){t.data||e.$router.push("login")})),this.$axios.get("/config/needInviteCode").then((function(t){e.needInviteCode=t.data})),this.invite_code=this.$route.query.code},methods:{onCaptchaVerify:function(e){this.recaptcha_v2=e},onSubmit:function(){var e=this;this.doing=!0,grecaptcha.ready((function(){grecaptcha.execute(e.v3_key,{action:"register"}).then((function(t){e.$axios.post("/user/auth/register",{user:e.username,pass:e.password,email:e.email,invite_code:e.invite_code,"recaptcha-v3-token":t,"g-recaptcha-response":e.recaptcha_v2}).then((function(t){t.data.success?e.$router.push("login"):t.data?void 0!==t.data.exists&&t.data.exists.length>0?t.data.exists.forEach((function(t){switch(t){case"username":e.username_exist=!0,e.$refs.username.validate();break;case"email":e.email_exist=!0,e.$refs.email.validate();break}})):t.data.invite_code_not_exist?(e.invite_code_exist=!1,e.$refs.inviteCode.validate()):(t.data.needV2&&(e.needV2=!0),e.$q.notify({position:"top",message:t.data.msg})):e.$q.notify({position:"top",message:"未知错误，请重试"}),e.doing=!1})).catch((function(t){e.doing=!1}))}))}))}},components:{"recaptcha-js-v3":{render:function(e){return e("script",{attrs:{type:"text/javascript",src:"https://www.recaptcha.net/recaptcha/api.js?render="+window.appConfig.recaptcha.v3_sitekey}})}},VueRecaptcha:s["a"]},computed:{v3_key:function(){return window.appConfig.recaptcha.v3_sitekey},v2_key:function(){return window.appConfig.recaptcha.v2_sitekey},passwordConfirm:function(){return this.password===this.password_confirm},isEmail:function(){var e=new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$");return e.test(this.email)}}},o=r,c=n("2877"),u=n("eebe"),l=n.n(u),d=n("9989"),p=n("0378"),f=n("27f9"),m=n("9c40"),h=Object(c["a"])(o,a,i,!1,null,null,null);t["default"]=h.exports;l()(h,"components",{QPage:d["a"],QForm:p["a"],QInput:f["a"],QBtn:m["a"]})}}]);