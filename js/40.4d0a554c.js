(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[40],{"80ab":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"flex flex-center"},[a("div",{staticClass:"auth-form"},[a("h4",{staticClass:"text-center"},[e._v("登录")]),a("q-form",{staticClass:"q-gutter-md",on:{submit:e.onSubmit}},[a("q-input",{attrs:{filled:"",label:"用户名/邮箱","lazy-rules":"",rules:[function(e){return e&&e.length>0||"请输入用户名或邮箱"}]},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),a("q-input",{attrs:{filled:"",type:"password",label:"密码","lazy-rules":"",rules:[function(e){return e&&e.length>0||"请输入密码"}]},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e.enableTelegramLogin?a("vue-telegram-login",{attrs:{mode:"callback","telegram-login":e.tgBotName},on:{callback:e.onTelegramLogin}}):e._e(),e.showRecaptcha?a("vue-recaptcha",{ref:"recaptcha",attrs:{sitekey:e.v2_key,loadRecaptchaScript:!0,recaptchaHost:"www.recaptcha.net"},on:{verify:e.onCaptchaVerify,expired:e.onCaptchaExpire}}):e._e(),a("div",[a("q-btn",{attrs:{label:"登录",type:"submit",color:"primary",loading:e.doing,disable:e.doing}}),e.allowRegister?a("q-btn",{staticClass:"q-ml-sm",attrs:{label:"去注册",color:"primary",flat:"",to:"/register"}}):e._e(),a("q-btn",{staticClass:"q-ml-sm",attrs:{label:"忘记密码",color:"primary",flat:"",to:"/password_reset_request"}})],1)],1)],1)])},s=[],o=(a("551c"),a("06db"),a("097d"),a("d226")),i=a("e096"),r={data:function(){return{username:"",password:"",showRecaptcha:!1,recaptchaToken:null,doing:!1,allowRegister:!1,enableTelegramLogin:!1,tgBotName:null}},created:function(){var e=this;this.$axios.get("/option/allowRegister").then((function(t){e.allowRegister=t.data||!1})),this.$axios.get("/telegram/bot_name?site="+this.site).then((function(t){var a=t.data||!1;a&&(e.enableTelegramLogin=!0,e.tgBotName=a)}))},methods:{onCaptchaVerify:function(e){this.recaptchaToken=e},onCaptchaExpire:function(){this.recaptchaToken=null},onSubmit:function(){this.showRecaptcha?this.login():this.showRecaptcha=!0},login:function(){var e=this;if(!this.recaptchaToken)return this.$q.notify("请先完成人机验证(reCAPTCHA)");this.doing=!0;var t={user:this.username,pass:this.password,recaptcha:this.recaptchaToken};this.$axios.post("/user/auth/login",t).then((function(t){t.data.success?(e.$store.dispatch("auth/login",t.data.token),e.$store.dispatch("auth/expire",t.data.expire),e.$router.push(e.$route.query.redirect||"overview")):(e.$q.notify({position:"top",message:t.data.msg}),e.$refs.recaptcha.reset(),e.recaptchaToken=null)})).catch((function(){e.$q.notify({position:"top",message:"未知错误，请重试"})})).finally((function(){e.doing=!1}))},onTelegramLogin:function(e){var t=this;this.$q.loading.show({delay:400}),this.$axios.post("/user/auth/telegram",e).then((function(e){t.$store.dispatch("auth/login",e.data.token),t.$store.dispatch("auth/expire",e.data.expire),t.$router.push(t.$route.query.redirect||"overview")})).catch((function(e){switch(e.response.status){case 403:case 404:case 419:t.$q.notify(e.response.data.message);break;default:t.$q.notify("未知错误")}})).finally((function(){t.$q.loading.hide()}))}},components:{vueTelegramLogin:o["vueTelegramLogin"],VueRecaptcha:i["a"]},computed:{v2_key:function(){return window.appConfig.recaptcha},site:function(){return window.appConfig.site}}},c=r,l=a("2877"),u=a("eebe"),p=a.n(u),h=a("9989"),d=a("0378"),g=a("27f9"),f=a("9c40"),m=Object(l["a"])(c,n,s,!1,null,null,null);t["default"]=m.exports;p()(m,"components",{QPage:h["a"],QForm:d["a"],QInput:g["a"],QBtn:f["a"]})}}]);