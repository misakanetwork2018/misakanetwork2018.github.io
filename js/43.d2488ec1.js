(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[43],{"2a1a":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"flex flex-center"},[a("div",{staticClass:"auth-form"},[a("h4",{staticClass:"text-center"},[e._v("注册")]),a("q-form",{staticClass:"q-gutter-md",on:{submit:e.onSubmit}},[a("q-input",{directives:[{name:"show",rawName:"v-show",value:e.loaded,expression:"loaded"}],ref:"username",attrs:{filled:"",label:"用户名","lazy-rules":"",rules:[function(e){return e&&e.length>0||"请输入用户名"},function(){return!e.username_exist||"用户名已被占用"}]},on:{input:function(t){e.username_exist=!1}},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),a("q-skeleton",{directives:[{name:"show",rawName:"v-show",value:!e.loaded,expression:"!loaded"}],attrs:{type:"QInput"}}),a("q-input",{directives:[{name:"show",rawName:"v-show",value:e.loaded,expression:"loaded"}],attrs:{filled:"",type:"password",label:"密码","lazy-rules":"",rules:[function(e){return e&&e.length>=6&&e.length<=30||"请输入6-30位密码"}]},on:{input:function(t){!e.password_confirm||e.$refs.confirm.validate()}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),a("q-skeleton",{directives:[{name:"show",rawName:"v-show",value:!e.loaded,expression:"!loaded"}],attrs:{type:"QInput"}}),a("q-input",{directives:[{name:"show",rawName:"v-show",value:e.loaded,expression:"loaded"}],ref:"confirm",attrs:{filled:"",type:"password",label:"确认密码","lazy-rules":"",rules:[function(e){return e&&e.length>0||"请输入确认密码"},function(){return e.passwordConfirm||"密码与确认密码不相符"}]},model:{value:e.password_confirm,callback:function(t){e.password_confirm=t},expression:"password_confirm"}}),a("q-skeleton",{directives:[{name:"show",rawName:"v-show",value:!e.loaded,expression:"!loaded"}],attrs:{type:"QInput"}}),a("q-input",{directives:[{name:"show",rawName:"v-show",value:e.loaded,expression:"loaded"}],ref:"email",attrs:{filled:"",label:"邮箱","lazy-rules":"",rules:[function(e){return e&&e.length>0||"请输入邮箱"},function(){return e.isEmail||"必须符合邮箱格式"},function(){return!e.email_exist||"邮箱已被占用"}]},on:{input:function(t){e.email_exist=!1}},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),a("q-skeleton",{directives:[{name:"show",rawName:"v-show",value:!e.loaded,expression:"!loaded"}],attrs:{type:"QInput"}}),a("q-input",{directives:[{name:"show",rawName:"v-show",value:e.loaded,expression:"loaded"}],ref:"inviteCode",attrs:{filled:"",label:"邀请码"+(e.needInviteCode?"":"(可选)"),"lazy-rules":"",rules:[function(t){return!e.needInviteCode||t&&t.length>0||"请输入邀请码"},function(){return e.invite_code_exist||"邀请码不存在"}]},on:{input:function(t){e.invite_code_exist=!0}},model:{value:e.invite_code,callback:function(t){e.invite_code=t},expression:"invite_code"}}),a("q-skeleton",{directives:[{name:"show",rawName:"v-show",value:!e.loaded,expression:"!loaded"}],attrs:{type:"QInput"}}),a("vue-recaptcha",{attrs:{sitekey:e.v2_key,loadRecaptchaScript:!0,recaptchaHost:"www.recaptcha.net"},on:{verify:e.onCaptchaVerify}}),a("div",[a("q-btn",{attrs:{label:"注册",type:"submit",color:"primary",loading:e.doing,disable:e.doing||!e.loaded}}),a("q-btn",{staticClass:"q-ml-sm",attrs:{label:"返回登录",color:"primary",flat:"",to:"/login"}})],1)],1)],1)])},s=[],i=(a("3b2b"),a("551c"),a("06db"),a("097d"),a("967e")),o=a.n(i),r=(a("96cf"),a("fa84")),l=a.n(r),d=a("e096"),c={data:function(){return{username:"",password:"",password_confirm:"",email:"",invite_code:"",recaptchaToken:null,username_exist:!1,email_exist:!1,invite_code_exist:!0,doing:!1,needInviteCode:!0,loaded:!1}},created:function(){var e=this;return l()(o.a.mark((function t(){var a,n;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$axios.get("/option/allowRegister");case 2:if(a=t.sent,a.data){t.next=6;break}return t.next=6,e.$router.push("login");case 6:return t.next=8,e.$axios.get("/option/needInviteCode");case 8:n=t.sent,e.needInviteCode=n.data||!1,e.invite_code=e.$route.query.code,e.loaded=!0;case 12:case"end":return t.stop()}}),t)})))()},methods:{onCaptchaVerify:function(e){this.recaptchaToken=e},onSubmit:function(){var e=this;if(!this.recaptchaToken)return this.$q.notify("请先完成人机验证(reCAPTCHA)");this.doing=!0,this.$axios.post("/user/auth/register",{user:this.username,pass:this.password,email:this.email,invite_code:this.invite_code,recaptcha:this.recaptchaToken}).then((function(t){t.data.success?e.$router.push("login"):t.data?void 0!==t.data.exists&&t.data.exists.length>0?t.data.exists.forEach((function(t){switch(t){case"username":e.username_exist=!0,e.$refs.username.validate();break;case"email":e.email_exist=!0,e.$refs.email.validate();break}})):t.data.invite_code_not_exist?(e.invite_code_exist=!1,e.$refs.inviteCode.validate()):e.$q.notify({position:"top",message:t.data.msg}):e.$q.notify({position:"top",message:"未知错误，请重试"})})).finally((function(){e.doing=!1}))}},components:{VueRecaptcha:d["a"]},computed:{v2_key:function(){return window.appConfig.recaptcha},passwordConfirm:function(){return this.password===this.password_confirm},isEmail:function(){var e=new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$");return e.test(this.email)}}},u=c,p=a("2877"),m=a("eebe"),f=a.n(m),v=a("9989"),h=a("0378"),w=a("27f9"),x=a("293e"),_=a("9c40"),b=Object(p["a"])(u,n,s,!1,null,null,null);t["default"]=b.exports;f()(b,"components",{QPage:v["a"],QForm:h["a"],QInput:w["a"],QSkeleton:x["a"],QBtn:_["a"]})}}]);