(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{"47cd":function(t,e,i){"use strict";var a=i("5c6a"),o=i.n(a);o.a},"5c6a":function(t,e,i){},"5f3f":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("h4",{staticClass:"text-center"},[t._v("创建工单")]),i("div",{staticClass:"ticket-form"},[i("q-form",{staticClass:"q-mb-md",on:{submit:t.onSubmit,reset:t.onReset}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-md-grow q-gutter-md"},[i("q-input",{attrs:{filled:"",label:"标题 *","lazy-rules":"",rules:[function(t){return t&&t.length>0||"请输入标题"}]},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}}),i("div",{staticClass:"row"},[i("div",{staticClass:"q-mr-md",staticStyle:{"line-height":"40px"}},[t._v("类型")]),i("q-option-group",{attrs:{options:t.options,color:"primary",inline:""},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}})],1),"service"==t.form.type||"refund"==t.form.type?i("q-select",{attrs:{filled:"",options:t.services,multiple:"","emit-value":"","map-options":"",label:"涉及的服务(可多选)",loading:t.serviceLoading},model:{value:t.form.services,callback:function(e){t.$set(t.form,"services",e)},expression:"form.services"}}):t._e(),i("q-editor",{ref:"editor",attrs:{"min-height":"10rem",placeholder:"内容",toolbar:[["bold","italic","underline","strike"],["undo","redo"]]},nativeOn:{paste:function(e){return function(e){return t.contentProcess(e)}(e)},drop:function(e){return function(e){return t.contentProcess(e)}(e)}},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}}),i("div",[i("q-btn",{attrs:{label:"提交",type:"submit",color:"primary"}}),i("q-btn",{staticClass:"q-ml-sm",attrs:{label:"重置",type:"reset",color:"primary",flat:""}})],1)],1),i("div",{staticClass:"q-gutter-md q-ml-xs q-mt-md",staticStyle:{width:"350px"}},[i("q-uploader",{attrs:{url:t.uploadUrl,headers:t.uploadHeader,label:"上传附件",multiple:""},on:{uploaded:t.uploaded}}),i("p",[t._v("注意：选择文件后，请手动点击上传按钮，否则不会上传")]),i("p",{staticClass:"text-center"},[i("q-btn",{attrs:{flat:"",color:"primary",label:"已上传附件列表"},on:{click:t.showUploaded}})],1)],1)])]),i("q-dialog",{model:{value:t.showFiles,callback:function(e){t.showFiles=e},expression:"showFiles"}},[i("q-card",[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("已上传文件列表")])]),i("q-card-section",{staticClass:"q-pt-none"},t._l(t.fileList,(function(e,a){return i("div",{key:a},[i("p",[i("q-icon",{attrs:{name:"attach_file"}}),t._v("\n              "+t._s(e.name)+"\n              "),i("q-btn",{attrs:{icon:"delete",round:"",size:"sm",flat:""},on:{click:function(e){return t.deleteAttach(a)}}})],1)])})),0),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"关闭",color:"primary"}})],1)],1)],1),i("q-dialog",{attrs:{persistent:""},model:{value:t.deleting,callback:function(e){t.deleting=e},expression:"deleting"}},[i("q-card",[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("警告")])]),i("q-card-section",{staticClass:"row items-center"},[t._v("\n          您打算删除文件 "+t._s(t.fileList[t.deletingId]?t.fileList[t.deletingId].name:"")+" 吗\n        ")]),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"否",color:"primary"}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"是",color:"primary"},on:{click:function(e){return t.deleteAttach(t.deletingId,!0)}}})],1)],1)],1)],1)])},o=[],s=(i("ac6a"),i("cadf"),i("06db"),i("456d"),i("a481"),{data:function(){return{form:{title:"",type:"service",services:[],content:"",files:[]},options:[{label:"服务售后",value:"service"},{label:"咨询",value:"consult"},{label:"退款",value:"refund"},{label:"建议",value:"advice"},{label:"投诉",value:"complain"}],services:[],fileList:{},showFiles:!1,deleting:!1,deletingId:0,serviceLoading:!1}},created:function(){var t=this;this.serviceLoading=!0,this.$axios.get("/service/selectList").then((function(e){t.services=e.data,t.serviceLoading=!1}))},methods:{onSubmit:function(){var t=this;""!==this.form.content.replace(/<[^<>]+>/g,"")?(this.form.files=Object.keys(this.fileList),this.$axios.post("/ticket/create",this.form).then((function(e){t.$router.push("/ticket/"+e.data)})).catch((function(){t.$q.notify({message:"提交失败，请重试",color:"red",position:"top"})}))):this.$q.notify({message:"请输入内容",color:"orange",position:"center"})},onReset:function(){this.form={title:"",type:"service",services:[],content:"",files:[]}},contentProcess:function(t){var e,i;t.preventDefault(),t.originalEvent&&t.originalEvent.clipboardData.getData?(e=t.originalEvent.clipboardData.getData("text/plain"),this.$refs.editor.runCmd("insertText",e)):t.clipboardData&&t.clipboardData.getData?(e=t.clipboardData.getData("text/plain"),this.$refs.editor.runCmd("insertText",e)):window.clipboardData&&window.clipboardData.getData&&(i||(i=!0,this.$refs.editor.runCmd("ms-pasteTextOnly",e)),i=!1)},uploaded:function(t){var e=t.files,i=t.xhr,a=JSON.parse(i.response)[0];this.fileList[a]=e[0]},showUploaded:function(){this.showFiles=!0},deleteAttach:function(t,e){var i=this;e?this.$axios.post("/file/delete/"+t).then((function(){i.$q.notify("已删除"),i.$delete(i.fileList,t)})).catch((function(){i.$q.notify("删除失败")})):(this.deletingId=t,this.deleting=!0)}},components:{},computed:{uploadUrl:function(){return window.appConfig.apiUrl+"/upload"},uploadHeader:function(){return[{name:"Authorization",value:"Bearer ".concat(this.$store.getters.authToken)}]}}}),n=s,r=(i("47cd"),i("2877")),l=i("eebe"),c=i.n(l),d=i("0378"),p=i("27f9"),u=i("9f0a"),f=i("ddd8"),m=i("d66b"),v=i("9c40"),h=i("ee89"),b=i("24e8"),g=i("f09f"),q=i("a370"),w=i("0016"),y=i("4b7e"),x=i("7f67"),C=Object(r["a"])(n,a,o,!1,null,"53d225ac",null);e["default"]=C.exports;c()(C,"components",{QForm:d["a"],QInput:p["a"],QOptionGroup:u["a"],QSelect:f["a"],QEditor:m["a"],QBtn:v["a"],QUploader:h["a"],QDialog:b["a"],QCard:g["a"],QCardSection:q["a"],QIcon:w["a"],QCardActions:y["a"]}),c()(C,"directives",{ClosePopup:x["a"]})}}]);