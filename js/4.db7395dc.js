(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"0f48":function(e,t,n){"use strict";var a=n("11e3"),o=n.n(a);o.a},"11e3":function(e,t,n){},"1c93":function(e,t,n){"use strict";t["a"]={deep:!0,handler:function(e){e&&(this.refresh(),this.$store.dispatch("base/refreshEnd"))}}},"47f0":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-dialog",{model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("q-card",[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("续费")])]),n("q-card-section",{staticClass:"q-pt-none"},[n("p",{staticClass:"q-mx-xs"},[e._v("温馨提示：默认情况下，系统会自动出账，无需手动出账。")]),e.loading?n("div"):n("q-form",[n("div",{staticClass:"q-mx-xs"},[n("p",[e._v("续费价格："+e._s(e.info.price)+"元/"+e._s(e.info.period)+"天")]),n("p",{staticClass:"q-mb-lg"},[e._v("续费天数（只能选1-12个周期）")]),n("div",{staticClass:"q-ma-xs"},[n("q-slider",{attrs:{min:1,max:12,label:"","label-value":e.sliderLabel,"label-always":""},model:{value:e.form.periodTimes,callback:function(t){e.$set(e.form,"periodTimes",t)},expression:"form.periodTimes"}})],1),n("p",[e._v("小计：￥"+e._s(e.amount.toFixed(2)))]),n("p",[e._v("优惠：￥"+e._s(e.discount.toFixed(2)))]),n("p",[e._v("总计：￥"+e._s(e.total.toFixed(2)))]),n("p",[e._v("请注意：此处使用的优惠码，不会绑定到服务；此处不填写优惠码，则账单中会使用服务绑定的优惠码（如果可用）；\n            若此处填写可用的优惠码，则账单中会使用该优惠码，且不与绑定的优惠码叠加。")])]),n("div",{staticClass:"q-gutter-sm"},[n("div",{staticClass:"q-ma-md"},[e.promotion.pass?e._e():n("q-input",{attrs:{label:"优惠码"},scopedSlots:e._u([{key:"append",fn:function(){return[""!==e.form.promotionCode?n("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(t){e.form.promotionCode=""}}}):e._e(),n("q-btn",{attrs:{flat:"",color:"primary",label:"验证"},on:{click:e.promotionCodeCheck}})]},proxy:!0}],null,!1,1562885562),model:{value:e.form.promotionCode,callback:function(t){e.$set(e.form,"promotionCode",t)},expression:"form.promotionCode"}})],1),e.promotion.pass?n("p",{staticClass:"q-mt-md"},[e._v("\n            优惠："+e._s(e.promotion.show)+"\n            "),n("q-btn",{attrs:{flat:"",label:"撤销优惠"},on:{click:e.removePromotion}})],1):e._e(),n("div",{staticClass:"row inline q-gutter-md q-mx-xs"},[n("div",[e._v("支付方式")]),n("q-option-group",{attrs:{options:e.payments,color:"primary",inline:"",dense:""},model:{value:e.form.payment,callback:function(t){e.$set(e.form,"payment",t)},expression:"form.payment"}})],1)]),n("div",{staticClass:"q-mt-sm"},[n("q-checkbox",{attrs:{label:"使用余额支付（余额："+e.info.credit+"元）"},model:{value:e.form.useCredit,callback:function(t){e.$set(e.form,"useCredit",t)},expression:"form.useCredit"}})],1),n("q-checkbox",{model:{value:e.accept,callback:function(t){e.accept=t},expression:"accept"}},[e._v("\n          我同意御坂网络的\n          "),n("b",[n("router-link",{attrs:{to:"/tos"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.href,o=t.navigate;return[n("a",{attrs:{href:a,target:"_blank"},on:{click:function(e){return e.stopPropagation(),o(e)}}},[e._v("TOS")])]}}])})],1),e._v("\n          及\n          "),n("b",[n("router-link",{attrs:{to:"/aup"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.href,o=t.navigate;return[n("a",{attrs:{href:a,target:"_blank"},on:{click:function(e){return e.stopPropagation(),o(e)}}},[e._v("AUP")])]}}])})],1)])],1)],1),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"}}),n("q-btn",{attrs:{flat:"",label:"续费",color:"primary"},on:{click:e.createInvoice}})],1)],1)],1)},o=[],i={data:function(){return{visible:!1,loading:!1,info:{},form:{id:0,periodTimes:1,payment:null,useCredit:!1,promotionCode:null},promotion:{show:"",discount:0,code:"",pass:!1},payment:null,accept:!1,payments:[],defaultDiscount:0}},methods:{load:function(e){var t=this;this.loading=!0,this.$axios.get("/service/checkRenew/"+e).then((function(n){var a=n.data,o=a.renewable,i=a.msg,s=a.info,r=a.payment,c=a.useCredit,l=a.discount;o?(t.info=s,t.form={id:e,periodTimes:1,payment:r,useCredit:c,promotionCode:""},t.defaultDiscount=l,t.promotion={show:"",discount:l,code:"",pass:!1},t.$forceUpdate(),t.loading=!1,t.show(),t.getPayments()):t.$q.dialog({title:"警告",message:i})}))},show:function(){this.visible=!1,this.visible=!0},hide:function(){this.visible=!1},promotionCodeCheck:function(){var e=this;this.$axios.post("/product/promotion_code/check",{code:this.form.promotionCode,pid:this.info.pid,renew:!0,times:this.form.periodTimes}).then((function(t){t.data.success?e.promotion=t.data.promotion:(e.$q.dialog({title:"优惠码无效",message:t.data.msg}),e.form.promotionCode="")}))},removePromotion:function(){this.form.promotionCode=null,this.promotion.code="",this.promotion.pass=!1,this.promotion.discount=this.defaultDiscount},getPayments:function(){var e=this;this.$axios.get("/payments").then((function(t){var n=[],a=t.data;for(var o in a)n.push({label:a[o],value:o});e.payments=n}))},createInvoice:function(){var e=this;this.accept?!this.form.promotionCode||this.promotion.pass?this.$axios.post("/service/renew",this.form).then((function(t){t.data.success&&("service"===t.data.to?(e.$emit("refresh"),e.visible=!1,e.$q.notify("续费成功")):e.$router.push({name:"invoice",params:{id:t.data.id}}))})):this.$q.dialog({title:"警告",message:"请先验证优惠码，否则请删除它"}):this.$q.dialog({title:"警告",message:"请勾选同意协议后再购买"})}},computed:{sliderLabel:function(){return this.form.periodTimes*this.info.period+"天"},amount:function(){return this.form.periodTimes*this.info.price},discount:function(){return this.promotion.discount},total:function(){return this.amount-this.discount}},watch:{"form.periodTimes":{deep:!0,handler:function(){this.removePromotion()}}}},s=i,r=n("2877"),c=n("eebe"),l=n.n(c),d=n("24e8"),u=n("f09f"),f=n("a370"),m=n("0378"),p=n("c1d0"),v=n("27f9"),h=n("0016"),b=n("9c40"),g=n("9f0a"),_=n("8f8e"),q=n("4b7e"),y=n("7f67"),C=Object(r["a"])(s,a,o,!1,null,null,null);t["a"]=C.exports;l()(C,"components",{QDialog:d["a"],QCard:u["a"],QCardSection:f["a"],QForm:m["a"],QSlider:p["a"],QInput:v["a"],QIcon:h["a"],QBtn:b["a"],QOptionGroup:g["a"],QCheckbox:_["a"],QCardActions:q["a"]}),l()(C,"directives",{ClosePopup:y["a"]})},c181:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",[n("div",{directives:[{name:"show",rawName:"v-show",value:e.loaded,expression:"loaded"}],staticClass:"service-container"},[n("q-tabs",{staticClass:"text-grey",attrs:{"inline-label":"","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[n("q-tab",{attrs:{name:"overview",label:"总览"}}),n("q-tab",{attrs:{name:"settings",label:"订单管理"}}),e._l(e.customTabs,(function(e,t){return n("q-tab",{key:t,attrs:{name:t,label:e.title}})}))],2),n("q-tab-panels",{model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[n("q-tab-panel",{attrs:{name:"overview"}},[n("div",{staticClass:"row q-gutter-sm"},[n("div",{staticClass:"col-12 col-md-grow"},[n("q-card",{staticClass:"my-card",attrs:{flat:"",bordered:""}},[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("快速管理")])]),n("q-separator",{attrs:{inset:""}}),n("q-card-section",[e.showManageAndUsage&&e.services[e.info.type].manage?n(e.services[e.info.type].manage,{ref:"manage",tag:"component",attrs:{info:e.info,product:e.product},on:{refresh:e.refresh}}):n("p",[e._v("无")])],1)],1)],1),n("div",{staticClass:"col-12 col-md-4"},[n("q-card",{staticClass:"my-card",attrs:{flat:"",bordered:""}},[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("产品信息")])]),n("q-separator",{attrs:{inset:""}}),n("q-card-section",[n("ul",{staticClass:"product-info"},[n("li",[e._v("\n                    标签："+e._s(e.info.name)+"\n                  ")]),n("li",[e._v("\n                    产品名称："+e._s(e.product.name)+"\n                  ")]),n("li",[e._v("\n                    产品类型："+e._s(e.$productType[e.product.type])+"\n                  ")]),n("li",[e._v("\n                    价格："+e._s(e.product.price)+"元\n                  ")]),n("li",[e._v("\n                    付费周期："+e._s(e.product.renewable?"每"+e.product.period+"天":"一次性")+"\n                  ")]),n("li",[e._v("\n                    创建时间："+e._s(e.$tools.tsmToString(e.info.created))+"\n                  ")]),n("li",[e._v("\n                    到期时间："+e._s(e.$tools.tsmToString(e.info.expire))+"\n                    "),!e.product.renewable||"active"!=e.info.status&&"suspended"!=e.info.status?e._e():n("q-btn",{attrs:{color:"primary",flat:"",label:"续费"},on:{click:e.renew}})],1),n("li",[e._v("\n                    状态：\n                    "),n("q-badge",{attrs:{color:e.$serviceStatusColor[e.info.status]}},[e._v("\n                      "+e._s(e.$serviceStatus[e.info.status])+"\n                    ")]),"pending"===e.info.status?n("q-btn",{attrs:{color:"primary",flat:""},on:{click:e.activateService}},[e._v("激活")]):e._e()],1)])])],1)],1)]),e.showManageAndUsage&&e.services[e.info.type].usage?n("q-card",{staticClass:"my-card",attrs:{flat:"",bordered:""}},[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("用量一览")])]),n("q-separator",{attrs:{inset:""}}),n("q-card-section",[n(e.services[e.info.type].usage,{ref:"usage",tag:"component",attrs:{info:e.info,product:e.product}})],1)],1):e._e()],1),n("q-tab-panel",{attrs:{name:"settings"}},[n("q-card",{staticClass:"my-card",attrs:{flat:"",bordered:""}},[n("q-card-section",[n("q-form",{staticClass:"q-gutter-md",on:{submit:e.order_save}},[n("q-input",{attrs:{filled:"",label:"标签（可空）",hint:"一个好的标签可以快速辨认出服务"},model:{value:e.info.name,callback:function(t){e.$set(e.info,"name",t)},expression:"info.name"}}),e.product.renewable?n("q-input",{attrs:{type:"number",filled:"",label:"到期提前出账天数",hint:"设为0则表示该订单不不再出账（已出账的账单不影响），系统默认设定为提前5天"},model:{value:e.info.invoice_days,callback:function(t){e.$set(e.info,"invoice_days",t)},expression:"info.invoice_days"}}):e._e(),n("div",[n("q-btn",{attrs:{label:"保存",type:"submit",color:"primary"}})],1)],1)],1)],1)],1),e._l(e.customTabs,(function(t,a){return n("q-tab-panel",{key:a,attrs:{name:a}},[n(t.page,{ref:"customTab",refInFor:!0,tag:"component",attrs:{info:e.info}})],1)}))],2)],1),n("q-inner-loading",{attrs:{showing:!e.loaded}},[n("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1),n("renew-dialog",{ref:"renew",on:{refresh:e.refresh}})],1)},o=[],i=(n("7f7f"),n("1c93")),s={base_ss:{manage:function(){return Promise.all([n.e(0),n.e(32)]).then(n.bind(null,"03c9"))},usage:function(){return Promise.all([n.e(0),n.e(10)]).then(n.bind(null,"68b6"))},tabs:{nodes:{title:"查看连接信息",page:function(){return Promise.all([n.e(0),n.e(9)]).then(n.bind(null,"41e4"))}}}},base_v2ray:{manage:function(){return n.e(33).then(n.bind(null,"100f"))},usage:function(){return Promise.all([n.e(0),n.e(12)]).then(n.bind(null,"4106"))},tabs:{nodes:{title:"查看连接信息",page:function(){return Promise.all([n.e(0),n.e(11)]).then(n.bind(null,"d26c"))}}}},node_ss:{manage:function(){return Promise.all([n.e(0),n.e(34)]).then(n.bind(null,"9a5f"))}},node_v2ray:{manage:function(){return Promise.all([n.e(0),n.e(35)]).then(n.bind(null,"f4fc"))}},trf_pkg:{manage:function(){return Promise.all([n.e(0),n.e(38)]).then(n.bind(null,"6ca4"))}},transfer_proxy:{manage:function(){return Promise.all([n.e(0),n.e(15)]).then(n.bind(null,"6a69"))},usage:function(){return n.e(16).then(n.bind(null,"a4d7"))}},pack_ss:{manage:function(){return Promise.all([n.e(0),n.e(36)]).then(n.bind(null,"c75a"))},usage:function(){return Promise.all([n.e(0),n.e(13)]).then(n.bind(null,"e83e"))}},pack_v2ray:{manage:function(){return Promise.all([n.e(0),n.e(37)]).then(n.bind(null,"3d24"))},usage:function(){return Promise.all([n.e(0),n.e(14)]).then(n.bind(null,"a7fe"))}}},r=n("47f0"),c={data:function(){return{tab:"overview",services:s,info:{},product:{},loaded:!1,manageComponent:null,usageComponent:null,saveConfirm:!1}},created:function(){this.refresh()},computed:{customTabs:function(){return"active"===this.info.status&&s[this.info.type]?s[this.info.type].tabs:[]},showManageAndUsage:function(){return this.info.type&&s[this.info.type]&&"active"===this.info.status}},methods:{refresh:function(){var e=this;this.$axios.get("/service/"+this.$route.params.id).then((function(t){var n=t.data,a=n.info,o=n.product;e.info=a,e.product=o,e.loaded=!0})),this.$nextTick((function(){var t=e.$refs.manage;t&&t.refresh&&t.refresh();var n=e.$refs.usage;n&&n.refresh&&n.refresh();var a=e.$refs.customTab;for(var o in a){var i=a[o];i&&i.refresh&&i.refresh()}}))},renew:function(){this.$refs.renew.load(this.info.id)},order_save:function(){var e=this;this.$axios.post("/service/saveOrderSettings",{id:this.info.id,data:{name:this.info.name,invoice_days:this.info.invoice_days}}).then((function(t){t.data.success?e.$q.notify("保存成功"):e.$q.notify(t.data.msg||"保存失败")}))},activateService:function(){var e=this;this.$axios.post("/service/activate",{id:this.info.id}).then((function(t){t.data.success?(e.$q.notify({type:"success",message:"激活成功"}),e.refresh()):e.$q.notify(t.data.msg||"激活失败")}))}},watch:{"$store.getters.refresh":i["a"],"info.extra.remind":{deep:!0,handler:function(e){if(void 0!==e&&null!==e){var t=parseInt(e);isNaN(t)&&(t=0),this.info.extra.remind=t}}}},components:{RenewDialog:r["a"]}},l=c,d=(n("0f48"),n("2877")),u=n("eebe"),f=n.n(u),m=n("9989"),p=n("429b"),v=n("7460"),h=n("adad"),b=n("823b"),g=n("f09f"),_=n("a370"),q=n("eb85"),y=n("9c40"),C=n("58a8"),x=n("0378"),w=n("27f9"),k=n("74f7"),$=n("cf57"),P=Object(d["a"])(l,a,o,!1,null,"5b965e95",null);t["default"]=P.exports;f()(P,"components",{QPage:m["a"],QTabs:p["a"],QTab:v["a"],QTabPanels:h["a"],QTabPanel:b["a"],QCard:g["a"],QCardSection:_["a"],QSeparator:q["a"],QBtn:y["a"],QBadge:C["a"],QForm:x["a"],QInput:w["a"],QInnerLoading:k["a"],QSpinnerGears:$["a"]})}}]);