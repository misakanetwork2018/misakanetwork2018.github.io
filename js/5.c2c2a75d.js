(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{1746:function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-page",[t.loaded?e("div",{staticClass:"invoice-container"},[e("div",{staticClass:"row justify-center items-start q-gutter-md"},[e("div",{staticClass:"col-12 col-md-9"},[e("q-card",{staticClass:"left-card"},[e("q-card-section",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-sm-7"},[e("div",{staticClass:"text-h4"},[t._v("\n                  账单编号 #"+t._s(t.data.id)+"\n                  "),e("q-badge",{attrs:{transparent:"",align:"middle",color:t.$invoiceStatus.color[t.data.status]}},[t._v("\n                    "+t._s(t.$invoiceStatus.text[t.data.status])+"\n                  ")])],1)]),e("div",{staticClass:"col-12 col-sm-5"},[e("div",{staticClass:"row justify-between"},[e("span",[t._v("开具时间")]),e("span",[t._v(t._s(t.$tools.tsmToString(t.data.created)))])]),e("div",{staticClass:"row justify-between"},[e("span",[t._v("过期时间")]),e("span",[t._v(t._s(t.$tools.tsmToString(t.data.expire)))])])])])]),e("q-card-section",[e("p",{staticClass:"text-h6"},[t._v("项目")]),e("table",{staticClass:"table"},[e("thead",[e("tr",[e("th",{attrs:{width:"61%"}},[t._v("描述")]),e("th",{attrs:{width:"20%"}}),e("th",{attrs:{width:"19%"}},[t._v("金额")])])]),e("tbody",[t._l(t.data.items,(function(a,s){return e("tr",{key:s},[e("td",{attrs:{colspan:"2"}},[t._v(t._s(a.description))]),e("td",[t._v("￥"+t._s(a.amount.toFixed(2)))])])})),e("tr",{staticClass:"sub-total-row first"},[e("td"),e("td",[t._v("小计")]),e("td",[t._v("￥"+t._s(t.data.subtotal.toFixed(2)))])]),e("tr",{staticClass:"sub-total-row last"},[e("td"),e("td",[t._v("账户余额支付")]),e("td",{class:0==t.data.status?"cursor-pointer":""},[t._v("\n                    ￥"+t._s(t.data.credit.toFixed(2))+"\n                    "),0==t.data.status?e("q-popup-edit",{attrs:{validate:t.creditValidation,buttons:""},on:{save:function(a){return t.changeCredit(a)}},model:{value:t.editCreate,callback:function(a){t.editCreate=a},expression:"editCreate"}},[e("q-input",{attrs:{type:"number",min:"0",dense:"",autofocus:"",error:!t.creditValid},on:{input:function(a){return t.creditValidation(t.editCreate)}},model:{value:t.editCreate,callback:function(a){t.editCreate=t._n(a)},expression:"editCreate"}})],1):t._e()],1)]),e("tr",{staticClass:"total-row"},[e("td"),e("td",{staticClass:"text-subtitle2"},[t._v("总计")]),e("td",{staticClass:"h3"},[t._v("￥"+t._s(t.data.total.toFixed(2)))])])],2)])]),e("q-card-section",[e("p",{staticClass:"text-h6"},[t._v("交易")]),e("table",{staticClass:"table"},[e("thead",[e("tr",[e("th",{attrs:{width:"36%"}},[t._v("交易日期")]),e("th",{attrs:{width:"20%"}},[t._v("网关")]),e("th",{attrs:{width:"25%"}},[t._v("交易编号")]),e("th",{attrs:{width:"19%"}},[t._v("金额")])])]),e("tbody",[0==t.data.trades.length?e("tr",[e("td",{staticClass:"text-center",attrs:{colspan:"4"}},[t._v("没有发现相关交易")])]):t._e(),t._l(t.data.trades,(function(a,s){return e("tr",{key:s},[e("td",[t._v(t._s(t.$tools.tsmToString(a.finished)))]),e("td",[t._v(t._s(t.getGatewayName(a.gateway)))]),e("td",[t._v(t._s(a.trade_no))]),e("td",[t._v("￥"+t._s(a.amount.toFixed(2)))])])})),e("tr",{staticClass:"total-row"},[e("td"),e("td"),e("td",{staticClass:"text-subtitle2"},[t._v("还需支付")]),e("td",[t._v("￥"+t._s(t.restPay.toFixed(2)))])])],2)])])],1)],1),e("div",{staticClass:"col-12 col-md"},[0==t.data.status?e("q-card",{staticClass:"my-card"},[e("q-card-section",[e("p",{staticClass:"text-subtitle1"},[t._v("需支付")]),e("div",{staticClass:"text-h4"},[t._v("￥ "+t._s(t.restPay.toFixed(2)))]),e("p"),e("p",{staticClass:"text-subtitle1"},[t._v("付款方式")]),e("q-select",{ref:"payment",attrs:{outlined:"",options:t.payments,dense:"","emit-value":"","map-options":"",loading:t.payment_loading,disable:t.payment_loading},on:{input:t.changePayment},model:{value:t.payment,callback:function(a){t.payment=a},expression:"payment"}}),t.payment_loading?t._e():e(t.paymentComponent,{tag:"component",attrs:{invoice:t.data.id},on:{finish:t.refresh}})],1)],1):t._e()],1)])]):t._e(),e("q-inner-loading",{attrs:{showing:!t.loaded}},[e("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1)},i=[],n=e("1c93"),d=e("25c6"),r={data:function(){return{data:{},loaded:!1,payment_loading:!1,paid_sum:0,payment:"",creditValid:!0,editCreate:0}},created:function(){this.refresh()},methods:{refresh:function(){var t=this;this.$axios.get("/invoice/"+this.$route.params.id).then((function(a){t.data=a.data,t.editCreate=a.data.credit,t.payment=a.data.payment,a.data.trades.forEach((function(a){t.paid_sum+=a.amount})),t.loaded=!0}))},changePayment:function(t){var a=this;this.payment_loading=!0,this.$axios.post("/invoice/"+this.data.id+"/payment",{payment:t}).then((function(e){e.data.success?a.data.payment=t:a.$q.notify("修改付款方式失败"),a.payment_loading=!1,a.payment=a.data.payment}))},getGatewayName:function(t){return window.appConfig.payments[t]},changeCredit:function(t,a){var e=this;this.$axios.post("/invoice/"+this.data.id+"/credit",{credit:t,confirm:a}).then((function(a){a.data.success?(e.refresh(),e.$q.notify("修改成功")):a.data.confirm?e.$q.dialog({title:"提示",cancel:!0,persistent:!0,message:a.data.msg}).onOk((function(){e.changeCredit(t,!0)})).onCancel((function(){e.editCreate=e.data.credit})):(e.$q.dialog({title:"警告",message:a.data.msg}),e.editCreate=e.data.credit)})).catch((function(){e.$q.notify("修改失败"),e.editCreate=e.data.credit}))},creditValidation:function(t){return this.creditValid=t>=0,this.creditValid}},computed:{payments:function(){var t=[],a=window.appConfig.payments;for(var e in a)t.push({label:a[e],value:e});return t},restPay:function(){var t=this.data.total-this.paid_sum;return t>0?t:0},paymentComponent:function(){return d["a"][this.data.payment]}},watch:{"$store.getters.refresh":n["a"]}},o=r,c=(e("b52f"),e("2877")),l=e("eebe"),u=e.n(l),p=e("9989"),m=e("f09f"),f=e("a370"),h=e("58a8"),_=e("42a1"),v=e("27f9"),C=e("ddd8"),y=e("74f7"),g=e("cf57"),b=Object(c["a"])(o,s,i,!1,null,"7272ff95",null);a["default"]=b.exports;u()(b,"components",{QPage:p["a"],QCard:m["a"],QCardSection:f["a"],QBadge:h["a"],QPopupEdit:_["a"],QInput:v["a"],QSelect:C["a"],QInnerLoading:y["a"],QSpinnerGears:g["a"]})},"1c93":function(t,a,e){"use strict";a["a"]={deep:!0,handler:function(t){t&&(this.refresh(),this.$store.dispatch("base/refreshEnd"))}}},"25c6":function(t,a,e){"use strict";a["a"]={alipay:function(){return Promise.all([e.e(0),e.e(28)]).then(e.bind(null,"b2d2"))},test:function(){return e.e(29).then(e.bind(null,"ea90"))}}},"514c":function(t,a,e){},b52f:function(t,a,e){"use strict";var s=e("514c"),i=e.n(s);i.a}}]);