(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[16],{"1c93":function(t,e,o){"use strict";e["a"]={deep:!0,handler:function(t){t&&(this.refresh(),this.$store.dispatch("base/refreshEnd"))}}},"33ef":function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-page",[o("div",{staticClass:"q-pa-md"},[o("q-table",{attrs:{title:"我的服务",data:t.data,columns:t.columns,"table-style":"max-height: calc(100vh - 80px)","row-key":"id","virtual-scroll":"",pagination:t.pagination,"rows-per-page-options":[10,20,50,100],"no-data-label":"暂无服务",loading:t.loading,dense:t.$q.screen.lt.md,"binary-state-sort":""},on:{"update:pagination":function(e){t.pagination=e},"row-click":t.rowClick,request:t.loadList},scopedSlots:t._u([{key:"top",fn:function(){return[o("div",{staticClass:"q-table__title q-mr-md"},[t._v("我的服务")]),o("q-option-group",{attrs:{options:t.options,color:"green",type:"checkbox",inline:""},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}})]},proxy:!0},{key:"body-cell-name",fn:function(e){return[o("q-td",{attrs:{props:e}},[o("div",{staticClass:"text-subtitle1"},[t._v("\n            "+t._s(e.row.product.name)+" - "+t._s(t.$productType[e.row.product.type])+"\n          ")]),o("div",{staticClass:"cursor-pointer text-primary",on:{click:function(t){t.stopPropagation()}}},[t._v("\n            "+t._s(e.value)+"\n            "),o("q-popup-edit",{attrs:{title:"编辑服务标签",buttons:""},on:{save:function(o,a){return t.saveLabel(e,o,a)}},model:{value:e.row.name,callback:function(o){t.$set(e.row,"name",o)},expression:"props.row.name"}},[o("q-input",{attrs:{dense:"",autofocus:"",counter:""},model:{value:e.row.name,callback:function(o){t.$set(e.row,"name",o)},expression:"props.row.name"}})],1)],1)])]}},{key:"body-cell-price",fn:function(e){return[o("q-td",{attrs:{props:e}},[o("div",[t._v("\n            ￥"+t._s(e.row.product.price)+"\n          ")]),o("div",[t._v("\n            "+t._s(e.row.product.renewable?"每"+e.row.product.period+"天":"一次性")+"\n          ")])])]}},{key:"body-cell-op",fn:function(e){return[o("q-td",{attrs:{props:e}},[o("div",[o("q-btn",{attrs:{color:"primary",disable:!e.row.product.renewable||"active"!=e.row.status&&"suspended"!=e.row.status},on:{click:function(o){return o.stopPropagation(),t.renew(e.row.id)}}},[t._v("续费")]),o("q-btn",{attrs:{flat:"",to:{name:"service",params:{id:e.row.id}}},on:{click:function(t){t.stopPropagation()}}},[t._v("管理服务")])],1)])]}},{key:"body-cell-status",fn:function(e){return[o("q-td",{attrs:{props:e}},[o("div",[o("q-badge",{attrs:{color:t.$serviceStatusColor[e.value]}},[t._v("\n              "+t._s(t.$serviceStatus[e.value])+"\n            ")])],1)])]}}])})],1),o("renew-dialog",{ref:"renew",on:{refresh:function(e){return this.loadList({pagination:t.pagination})}}})],1)},i=[],n=(o("7f7f"),o("1c93")),s=o("47f0"),r={data:function(){var t=this;return{loading:!1,loaded:!1,data:[],columns:[{name:"id",label:"#",field:"id",align:"right",sortable:!0,style:"width: 80px"},{name:"name",required:!0,label:"产品/服务",align:"left",field:"name",sortable:!0},{name:"price",label:"价格",field:"price",align:"center",style:"width: 200px"},{name:"expire",label:"下次付款日",field:"expire",align:"left",sortable:!0,style:"width: 200px",format:function(e,o){return o.product.renewable?t.$tools.tsmToString(e,!1):"-"}},{name:"status",label:"状态",align:"center",field:"status",sortable:!0,style:"width: 80px"},{name:"op",label:"",align:"left",style:"width: 120px"}],status:[],options:[],pagination:{sortBy:"expire",descending:!1,page:1,rowsPerPage:10,rowsNumber:0}}},created:function(){var t=!0,e=localStorage.getItem("service_status_select"),o=[];for(var a in e?o=JSON.parse(e):t=!1,this.$serviceStatus){var i=this.$serviceStatus[a];this.options.push({label:i,value:a}),t&&-1===o.indexOf(a)||this.status.push(a)}localStorage.setItem("service_status_select",JSON.stringify(this.status)),this.refresh()},methods:{refresh:function(){this.loadList({pagination:this.pagination})},loadList:function(t){var e=this,o=t.pagination,a=o.page,i=o.rowsPerPage,n=o.sortBy,s=o.descending;this.loading=!0,this.showDialog=!1;var r=this.$tools.createListQuery(t.pagination);r.status=this.status,this.$axios.get("/service/list",{params:r}).then((function(t){var o=t.data,r=o.data,l=o.total;e.data=r,e.pagination.rowsNumber=l,e.loading=!1,e.pagination.page=a,e.pagination.rowsPerPage=i,e.pagination.sortBy=n,e.pagination.descending=s,e.loaded=!0}))},rowClick:function(t,e){this.$router.push({name:"service",params:{id:e.id}})},renew:function(t){this.$refs.renew.load(t)},saveLabel:function(t,e,o){var a=this;this.$axios.post("/service/saveOrderSettings",{id:t.row.id,data:{name:e}}).catch((function(){a.$q.notify("修改标签失败"),t.row.name=o}))}},components:{RenewDialog:s["a"]},watch:{"$store.getters.refresh":n["a"],status:function(t,e){this.loaded&&(0!==t.length?(this.refresh(),localStorage.setItem("service_status_select",JSON.stringify(t))):this.status=e)}}},l=r,c=o("2877"),p=o("eebe"),d=o.n(p),u=o("9989"),f=o("eaac"),m=o("9f0a"),v=o("db86"),h=o("42a1"),g=o("27f9"),b=o("9c40"),w=o("58a8"),_=Object(c["a"])(l,a,i,!1,null,"6bb08324",null);e["default"]=_.exports;d()(_,"components",{QPage:u["a"],QTable:f["a"],QOptionGroup:m["a"],QTd:v["a"],QPopupEdit:h["a"],QInput:g["a"],QBtn:b["a"],QBadge:w["a"]})},"47f0":function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-dialog",{model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[o("q-card",[o("q-card-section",[o("div",{staticClass:"text-h6"},[t._v("续费")])]),o("q-card-section",{staticClass:"q-pt-none"},[o("p",{staticClass:"q-mx-xs"},[t._v("温馨提示：默认情况下，系统会自动出账，无需手动出账。")]),t.loading?o("div"):o("div",[t.info.renewable?o("q-form",[o("div",{staticClass:"q-mx-xs"},[o("p",[t._v("续费价格："+t._s(t.info.price)+"元/"+t._s(t.info.period)+"天")]),o("p",{staticClass:"q-mb-lg"},[t._v("续费天数（只能选1-12个周期）")]),o("div",{staticClass:"q-ma-xs"},[o("q-slider",{attrs:{min:1,max:12,label:"","label-value":t.sliderLabel,"label-always":""},model:{value:t.form.periodTimes,callback:function(e){t.$set(t.form,"periodTimes",e)},expression:"form.periodTimes"}})],1),o("p",[t._v("总价格：￥"+t._s(t.amount.toFixed(2)))]),o("p",[t._v("请注意：此处使用的优惠码，不会绑定到服务；此处不填写优惠码，则账单中会使用服务绑定的优惠码（如果可用）；\n              若此处填写可用的优惠码，则账单中会使用该优惠码，且不与绑定的优惠码叠加。")])]),o("div",{staticClass:"q-gutter-sm"},[o("div",{staticClass:"q-ma-md"},[t.promotion.pass?t._e():o("q-input",{attrs:{label:"优惠码"},scopedSlots:t._u([{key:"append",fn:function(){return[""!==t.form.promotionCode?o("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(e){t.form.promotionCode=""}}}):t._e(),o("q-btn",{attrs:{flat:"",color:"primary",label:"验证"},on:{click:t.promotionCodeCheck}})]},proxy:!0}],null,!1,1562885562),model:{value:t.form.promotionCode,callback:function(e){t.$set(t.form,"promotionCode",e)},expression:"form.promotionCode"}})],1),t.promotion.pass?o("p",{staticClass:"q-mt-md"},[t._v("\n              优惠："+t._s(t.promotion.show)+"\n              "),o("q-btn",{attrs:{flat:"",label:"撤销优惠"},on:{click:function(e){t.promotion.code="",t.promotion.pass=!1}}})],1):t._e(),o("div",{staticClass:"row inline q-gutter-md q-mx-xs"},[o("div",[t._v("支付方式")]),o("q-option-group",{attrs:{options:t.payments,color:"primary",inline:"",dense:""},model:{value:t.form.payment,callback:function(e){t.$set(t.form,"payment",e)},expression:"form.payment"}})],1)]),o("div",{staticClass:"q-mt-sm"},[o("q-checkbox",{attrs:{label:"使用余额支付（余额："+t.info.credit+"元）"},model:{value:t.form.useCredit,callback:function(e){t.$set(t.form,"useCredit",e)},expression:"form.useCredit"}})],1),o("q-checkbox",{model:{value:t.accept,callback:function(e){t.accept=e},expression:"accept"}},[t._v("\n            我同意御坂网络的\n            "),o("b",[o("router-link",{attrs:{to:"/tos"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.href,i=e.navigate;return[o("a",{attrs:{href:a,target:"_blank"},on:{click:function(t){return t.stopPropagation(),i(t)}}},[t._v("TOS")])]}}])})],1),t._v("\n            及\n            "),o("b",[o("router-link",{attrs:{to:"/aup"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.href,i=e.navigate;return[o("a",{attrs:{href:a,target:"_blank"},on:{click:function(t){return t.stopPropagation(),i(t)}}},[t._v("AUP")])]}}])})],1)])],1):o("p",[t._v(t._s(t.info.msg))])],1)]),o("q-card-actions",{attrs:{align:"right"}},[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"}}),t.info.renewable?o("q-btn",{attrs:{flat:"",label:"续费",color:"primary"},on:{click:t.createInvoice}}):t._e()],1)],1)],1)},i=[],n={data:function(){return{visible:!1,loading:!1,info:{},form:{id:0,periodTimes:1,payment:null,useCredit:!1,promotionCode:null},promotion:{show:"",discount:0,code:"",pass:!1},payment:null,accept:!1}},methods:{load:function(t){var e=this;this.loading=!0,this.$axios.get("/service/checkRenew/"+t).then((function(o){var a=o.data,i=a.info,n=a.payment,s=a.useCredit;e.info=i,e.form={id:t,periodTimes:1,payment:n,useCredit:s,promotionCode:""},e.promotion={show:"",discount:0,code:"",pass:!1},e.promotionAlert={show:!1,msg:""},e.$forceUpdate(),e.loading=!1,e.show()}))},show:function(){this.visible=!1,this.visible=!0},hide:function(){this.visible=!1},promotionCodeCheck:function(){var t=this;this.$axios.post("/product/promotion_code/check",{code:this.form.promotionCode,pid:this.info.pid}).then((function(e){e.data.success?t.promotion=e.data.promotion:(t.$q.dialog({title:"优惠码无效",message:e.data.msg}),t.form.promotionCode="")}))},createInvoice:function(){var t=this;this.accept?!this.form.promotionCode||this.promotion.pass?this.$axios.post("/service/renew",this.form).then((function(e){e.data.success&&("service"===e.data.to?t.$emit("refresh"):t.$router.push({name:"invoice",params:{id:e.data.id}}))})):this.$q.dialog({title:"警告",message:"请先验证优惠码，否则请删除它"}):this.$q.dialog({title:"警告",message:"请勾选同意协议后再购买"})}},computed:{sliderLabel:function(){return this.form.periodTimes*this.info.period+"天"},amount:function(){return this.form.periodTimes*this.info.price},payments:function(){var t=[],e=window.appConfig.payments;for(var o in e)t.push({label:e[o],value:o});return t}}},s=n,r=o("2877"),l=o("eebe"),c=o.n(l),p=o("24e8"),d=o("f09f"),u=o("a370"),f=o("0378"),m=o("c1d0"),v=o("27f9"),h=o("0016"),g=o("9c40"),b=o("9f0a"),w=o("8f8e"),_=o("4b7e"),q=o("7f67"),y=Object(r["a"])(s,a,i,!1,null,null,null);e["a"]=y.exports;c()(y,"components",{QDialog:p["a"],QCard:d["a"],QCardSection:u["a"],QForm:f["a"],QSlider:m["a"],QInput:v["a"],QIcon:h["a"],QBtn:g["a"],QOptionGroup:b["a"],QCheckbox:w["a"],QCardActions:_["a"]}),c()(y,"directives",{ClosePopup:q["a"]})}}]);