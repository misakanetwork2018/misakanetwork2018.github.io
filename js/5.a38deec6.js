(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{1746:function(t,a,s){"use strict";s.r(a);var e=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("q-page",[t.loaded?s("div",{staticClass:"invoice-container"},[s("div",{staticClass:"row justify-center items-start q-gutter-md"},[s("div",{staticClass:"col-12 col-md-9"},[s("q-card",{staticClass:"left-card"},[s("q-card-section",[s("div",{staticClass:"row"},[s("div",{staticClass:"col-12 col-sm-7"},[s("div",{staticClass:"text-h4"},[t._v("\n                  账单编号 #"+t._s(t.data.id)+"\n                  "),s("q-badge",{attrs:{transparent:"",align:"middle",color:t.getStatusColor(t.data.status)}},[t._v("\n                    "+t._s(t.getStatus(t.data.status))+"\n                  ")])],1)]),s("div",{staticClass:"col-12 col-sm-5"},[s("div",{staticClass:"row justify-between"},[s("span",[t._v("开具时间")]),s("span",[t._v(t._s(t.$tools.tsmToString(t.data.created)))])]),s("div",{staticClass:"row justify-between"},[s("span",[t._v("过期时间")]),s("span",[t._v(t._s(t.$tools.tsmToString(t.data.expire)))])])])])]),s("q-card-section",[s("p",{staticClass:"text-h6"},[t._v("项目")]),s("table",{staticClass:"table"},[s("thead",[s("tr",[s("th",{attrs:{width:"61%"}},[t._v("描述")]),s("th",{attrs:{width:"20%"}}),s("th",{attrs:{width:"19%"}},[t._v("金额")])])]),s("tbody",[t._l(t.data.items,(function(a,e){return s("tr",{key:e},[s("td",{attrs:{colspan:"2"}},[t._v(t._s(a.description))]),s("td",[t._v("￥"+t._s(a.amount.toFixed(2)))])])})),s("tr",{staticClass:"sub-total-row first"},[s("td"),s("td",[t._v("小计")]),s("td",[t._v("￥"+t._s(t.data.subtotal.toFixed(2)))])]),s("tr",{staticClass:"sub-total-row last"},[s("td"),s("td",[t._v("账户余额支付")]),s("td",[t._v("￥"+t._s(t.data.credit.toFixed(2)))])]),s("tr",{staticClass:"total-row"},[s("td"),s("td",{staticClass:"text-subtitle2"},[t._v("总计")]),s("td",{staticClass:"h3"},[t._v("￥"+t._s(t.data.total.toFixed(2)))])])],2)])]),s("q-card-section",[s("p",{staticClass:"text-h6"},[t._v("交易")]),s("table",{staticClass:"table"},[s("thead",[s("tr",[s("th",{attrs:{width:"36%"}},[t._v("交易日期")]),s("th",{attrs:{width:"20%"}},[t._v("网关")]),s("th",{attrs:{width:"25%"}},[t._v("交易编号")]),s("th",{attrs:{width:"19%"}},[t._v("金额")])])]),s("tbody",[0==t.data.trades.length?s("tr",[s("td",{staticClass:"text-center",attrs:{colspan:"4"}},[t._v("没有发现相关交易")])]):t._e(),t._l(t.data.trades,(function(a,e){return s("tr",{key:e},[s("td",[t._v(t._s(t.$tools.tsmToString(a.finished)))]),s("td",[t._v(t._s(t.getGatewayName(a.gateway)))]),s("td",[t._v(t._s(a.trade_no))]),s("td",[t._v("￥"+t._s(a.amount.toFixed(2)))])])})),s("tr",{staticClass:"total-row"},[s("td"),s("td"),s("td",{staticClass:"text-subtitle2"},[t._v("还需支付")]),s("td",[t._v("￥"+t._s(t.restPay.toFixed(2)))])])],2)])])],1)],1),s("div",{staticClass:"col-12 col-md"},[0==t.data.status?s("q-card",{staticClass:"my-card"},[s("q-card-section",[s("p",{staticClass:"text-subtitle1"},[t._v("需支付")]),s("div",{staticClass:"text-h4"},[t._v("￥ "+t._s(t.restPay.toFixed(2)))]),s("p"),s("p",{staticClass:"text-subtitle1"},[t._v("付款方式")]),s("q-select",{ref:"payment",attrs:{outlined:"",options:t.payments,dense:"","emit-value":"","map-options":"",loading:t.payment_loading,disable:t.payment_loading},on:{input:t.changePayment},model:{value:t.payment,callback:function(a){t.payment=a},expression:"payment"}}),t.payment_loading?t._e():s(t.paymentComponent,{tag:"component",attrs:{invoice:t.data.id},on:{finish:t.refresh}})],1)],1):t._e()],1)])]):t._e(),s("q-inner-loading",{attrs:{showing:!t.loaded}},[s("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1)},n=[],i=s("1c93"),r=s("25c6"),d={data:function(){return{data:{},loaded:!1,payment_loading:!1,paid_sum:0,payment:""}},created:function(){this.refresh()},methods:{refresh:function(){var t=this;this.$axios.get("/invoice/"+this.$route.params.id).then((function(a){t.data=a.data,t.payment=a.data.payment,a.data.trades.forEach((function(a){t.paid_sum+=a.amount})),t.loaded=!0}))},getStatus:function(t){switch(parseInt(t)){case 0:return"未付款";case 1:return"已付款";case 2:return"已取消"}},getStatusColor:function(t){switch(parseInt(t)){case 0:return"red";case 1:return"green";case 2:return"grey"}},changePayment:function(t){var a=this;this.payment_loading=!0,this.$axios.post("/invoice/"+this.$route.params.id+"/payment",{payment:t}).then((function(s){s.data.success?a.data.payment=t:a.$q.notify("修改付款方式失败"),a.payment_loading=!1,a.payment=a.data.payment}))},getGatewayName:function(t){return window.appConfig.payments[t]}},computed:{payments:function(){var t=[],a=window.appConfig.payments;for(var s in a)t.push({label:a[s],value:s});return t},restPay:function(){var t=this.data.total-this.paid_sum;return t>0?t:0},paymentComponent:function(){return r["a"][this.data.payment]}},watch:{"$store.getters.refresh":i["a"]}},o=d,c=(s("fc03"),s("2877")),l=s("eebe"),u=s.n(l),p=s("9989"),_=s("f09f"),m=s("a370"),h=s("58a8"),v=s("ddd8"),f=s("74f7"),y=s("cf57"),g=Object(c["a"])(o,e,n,!1,null,"5b7ec780",null);a["default"]=g.exports;u()(g,"components",{QPage:p["a"],QCard:_["a"],QCardSection:m["a"],QBadge:h["a"],QSelect:v["a"],QInnerLoading:f["a"],QSpinnerGears:y["a"]})},"1c93":function(t,a,s){"use strict";a["a"]={deep:!0,handler:function(t){t&&(this.refresh(),this.$store.dispatch("base/refreshEnd"))}}},"25c6":function(t,a,s){"use strict";a["a"]={alipay:function(){return Promise.all([s.e(0),s.e(26)]).then(s.bind(null,"b2d2"))},test:function(){return s.e(27).then(s.bind(null,"ea90"))}}},"4a7f":function(t,a,s){},fc03:function(t,a,s){"use strict";var e=s("4a7f"),n=s.n(e);n.a}}]);