(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"1c93":function(t,e,o){"use strict";e["a"]={deep:!0,handler:function(t){t&&(this.refresh(),this.$store.dispatch("base/refreshEnd"))}}},"47f0":function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-dialog",{model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[o("q-card",[o("q-card-section",[o("div",{staticClass:"text-h6"},[t._v("续费")])]),o("q-card-section",{staticClass:"q-pt-none"},[o("p",{staticClass:"q-mx-xs"},[t._v("温馨提示：默认情况下，系统会自动出账，无需手动出账。")]),t.loading?o("div"):o("q-form",[o("div",{staticClass:"q-mx-xs"},[o("p",[t._v("续费价格："+t._s(t.info.price)+"元/"+t._s(t.info.period)+"天")]),o("p",{staticClass:"q-mb-lg"},[t._v("续费天数（只能选1-12个周期）")]),o("div",{staticClass:"q-ma-xs"},[o("q-slider",{attrs:{min:1,max:12,label:"","label-value":t.sliderLabel,"label-always":""},model:{value:t.form.periodTimes,callback:function(e){t.$set(t.form,"periodTimes",e)},expression:"form.periodTimes"}})],1),o("p",[t._v("小计：￥"+t._s(t.amount.toFixed(2)))]),o("p",[t._v("优惠：￥"+t._s(t.discount.toFixed(2)))]),o("p",[t._v("总计：￥"+t._s(t.total.toFixed(2)))]),o("p",[t._v("请注意：此处使用的优惠码，不会绑定到服务；此处不填写优惠码，则账单中会使用服务绑定的优惠码（如果可用）；\n            若此处填写可用的优惠码，则账单中会使用该优惠码，且不与绑定的优惠码叠加。")])]),o("div",{staticClass:"q-gutter-sm"},[o("div",{staticClass:"q-ma-md"},[t.promotion.pass?t._e():o("q-input",{attrs:{label:"优惠码"},scopedSlots:t._u([{key:"append",fn:function(){return[""!==t.form.promotionCode?o("q-icon",{staticClass:"cursor-pointer",attrs:{name:"close"},on:{click:function(e){t.form.promotionCode=""}}}):t._e(),o("q-btn",{attrs:{flat:"",color:"primary",label:"验证"},on:{click:t.promotionCodeCheck}})]},proxy:!0}],null,!1,1562885562),model:{value:t.form.promotionCode,callback:function(e){t.$set(t.form,"promotionCode",e)},expression:"form.promotionCode"}})],1),t.promotion.pass?o("p",{staticClass:"q-mt-md"},[t._v("\n            优惠："+t._s(t.promotion.show)+"\n            "),o("q-btn",{attrs:{flat:"",label:"撤销优惠"},on:{click:t.removePromotion}})],1):t._e(),o("div",{staticClass:"row inline q-gutter-md q-mx-xs"},[o("div",[t._v("支付方式")]),o("q-option-group",{attrs:{options:t.payments,color:"primary",inline:"",dense:""},model:{value:t.form.payment,callback:function(e){t.$set(t.form,"payment",e)},expression:"form.payment"}})],1)]),o("div",{staticClass:"q-mt-sm"},[o("q-checkbox",{attrs:{label:"使用余额支付（余额："+t.info.credit+"元）"},model:{value:t.form.useCredit,callback:function(e){t.$set(t.form,"useCredit",e)},expression:"form.useCredit"}})],1),o("q-checkbox",{model:{value:t.accept,callback:function(e){t.accept=e},expression:"accept"}},[t._v("\n          我同意御坂网络的\n          "),o("b",[o("router-link",{attrs:{to:"/tos"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.href,i=e.navigate;return[o("a",{attrs:{href:n,target:"_blank"},on:{click:function(t){return t.stopPropagation(),i(t)}}},[t._v("TOS")])]}}])})],1),t._v("\n          及\n          "),o("b",[o("router-link",{attrs:{to:"/aup"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.href,i=e.navigate;return[o("a",{attrs:{href:n,target:"_blank"},on:{click:function(t){return t.stopPropagation(),i(t)}}},[t._v("AUP")])]}}])})],1)])],1)],1),o("q-card-actions",{attrs:{align:"right"}},[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"}}),o("q-btn",{attrs:{flat:"",label:"续费",color:"primary"},on:{click:t.createInvoice}})],1)],1)],1)},i=[],a={data:function(){return{visible:!1,loading:!1,info:{},form:{id:0,periodTimes:1,payment:null,useCredit:!1,promotionCode:null},promotion:{show:"",discount:0,code:"",pass:!1},payment:null,accept:!1}},methods:{load:function(t){var e=this;this.loading=!0,this.$axios.get("/service/checkRenew/"+t).then((function(o){var n=o.data,i=n.renewable,a=n.msg,s=n.info,r=n.payment,c=n.useCredit;i?(e.info=s,e.form={id:t,periodTimes:1,payment:r,useCredit:c,promotionCode:""},e.promotion={show:"",discount:0,code:"",pass:!1},e.$forceUpdate(),e.loading=!1,e.show()):e.$q.dialog({title:"警告",message:a})}))},show:function(){this.visible=!1,this.visible=!0},hide:function(){this.visible=!1},promotionCodeCheck:function(){var t=this;this.$axios.post("/product/promotion_code/check",{code:this.form.promotionCode,pid:this.info.pid,renew:!0,times:this.form.periodTimes}).then((function(e){e.data.success?t.promotion=e.data.promotion:(t.$q.dialog({title:"优惠码无效",message:e.data.msg}),t.form.promotionCode="")}))},removePromotion:function(){this.promotion.code="",this.promotion.pass=!1,this.promotion.discount=0},createInvoice:function(){var t=this;this.accept?!this.form.promotionCode||this.promotion.pass?this.$axios.post("/service/renew",this.form).then((function(e){e.data.success&&("service"===e.data.to?(t.$emit("refresh"),t.visible=!1,t.$q.notify("续费成功")):t.$router.push({name:"invoice",params:{id:e.data.id}}))})):this.$q.dialog({title:"警告",message:"请先验证优惠码，否则请删除它"}):this.$q.dialog({title:"警告",message:"请勾选同意协议后再购买"})}},computed:{sliderLabel:function(){return this.form.periodTimes*this.info.period+"天"},amount:function(){return this.form.periodTimes*this.info.price},payments:function(){var t=[],e=window.appConfig.payments;for(var o in e)t.push({label:e[o],value:o});return t},discount:function(){return this.promotion.discount},total:function(){return this.amount-this.discount}},watch:{"form.periodTimes":{deep:!0,handler:function(){this.removePromotion()}}}},s=a,r=o("2877"),c=o("eebe"),l=o.n(c),d=o("24e8"),p=o("f09f"),u=o("a370"),f=o("0378"),m=o("c1d0"),h=o("27f9"),v=o("0016"),b=o("9c40"),g=o("9f0a"),_=o("8f8e"),q=o("4b7e"),C=o("7f67"),y=Object(r["a"])(s,n,i,!1,null,null,null);e["a"]=y.exports;l()(y,"components",{QDialog:d["a"],QCard:p["a"],QCardSection:u["a"],QForm:f["a"],QSlider:m["a"],QInput:h["a"],QIcon:v["a"],QBtn:b["a"],QOptionGroup:g["a"],QCheckbox:_["a"],QCardActions:q["a"]}),l()(y,"directives",{ClosePopup:C["a"]})},"8a96":function(t,e,o){"use strict";var n=o("c461"),i=o.n(n);i.a},c181:function(t,e,o){"use strict";o.r(e);var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-page",[o("div",{directives:[{name:"show",rawName:"v-show",value:t.loaded,expression:"loaded"}],staticClass:"service-container"},[o("q-tabs",{staticClass:"text-grey",attrs:{"inline-label":"","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[o("q-tab",{attrs:{name:"overview",label:"总览"}}),o("q-tab",{attrs:{name:"settings",label:"订单管理"}}),t._l(t.customTabs,(function(t,e){return o("q-tab",{key:e,attrs:{name:e,label:t.title}})}))],2),o("q-tab-panels",{model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[o("q-tab-panel",{attrs:{name:"overview"}},[o("div",{staticClass:"row q-gutter-sm"},[o("div",{staticClass:"col-12 col-md-grow"},[o("q-card",{staticClass:"my-card",attrs:{flat:"",bordered:""}},[o("q-card-section",[o("div",{staticClass:"text-h6"},[t._v("快速管理")])]),o("q-separator",{attrs:{inset:""}}),o("q-card-section",[t.showManageAndUsage&&t.services[t.info.type].manage?o(t.services[t.info.type].manage,{ref:"manage",tag:"component",attrs:{info:t.info},on:{refresh:t.refresh}}):o("p",[t._v("无")])],1)],1)],1),o("div",{staticClass:"col-12 col-md-4"},[o("q-card",{staticClass:"my-card",attrs:{flat:"",bordered:""}},[o("q-card-section",[o("div",{staticClass:"text-h6"},[t._v("产品信息")])]),o("q-separator",{attrs:{inset:""}}),o("q-card-section",[o("ul",{staticClass:"product-info"},[o("li",[t._v("\n                    标签："+t._s(t.info.name)+"\n                  ")]),o("li",[t._v("\n                    产品名称："+t._s(t.product.name)+"\n                  ")]),o("li",[t._v("\n                    产品类型："+t._s(t.$productType[t.product.type])+"\n                  ")]),o("li",[t._v("\n                    价格："+t._s(t.product.price)+"元\n                  ")]),o("li",[t._v("\n                    付费周期："+t._s(t.product.renewable?"每"+t.product.period+"天":"一次性")+"\n                  ")]),o("li",[t._v("\n                    创建时间："+t._s(t.$tools.tsmToString(t.info.created))+"\n                  ")]),o("li",[t._v("\n                    到期时间："+t._s(t.$tools.tsmToString(t.info.expire))+"\n                    "),!t.product.renewable||"active"!=t.info.status&&"suspended"!=t.info.status?t._e():o("q-btn",{attrs:{color:"primary",flat:"",label:"续费"},on:{click:t.renew}})],1),o("li",[t._v("\n                    状态：\n                    "),o("q-badge",{attrs:{color:t.$serviceStatusColor[t.info.status]}},[t._v("\n                      "+t._s(t.$serviceStatus[t.info.status])+"\n                    ")])],1)])])],1)],1)]),t.showManageAndUsage&&t.services[t.info.type].usage?o("q-card",{staticClass:"my-card",attrs:{flat:"",bordered:""}},[o("q-card-section",[o("div",{staticClass:"text-h6"},[t._v("用量一览")])]),o("q-separator",{attrs:{inset:""}}),o("q-card-section",[o(t.services[t.info.type].usage,{ref:"usage",tag:"component",attrs:{info:t.info}})],1)],1):t._e()],1),o("q-tab-panel",{attrs:{name:"settings"}},[o("q-card",{staticClass:"my-card",attrs:{flat:"",bordered:""}},[o("q-card-section",[o("q-form",{staticClass:"q-gutter-md",on:{submit:t.order_save}},[o("q-input",{attrs:{filled:"",label:"标签（可空）",hint:"一个好的标签可以快速辨认出服务"},model:{value:t.info.name,callback:function(e){t.$set(t.info,"name",e)},expression:"info.name"}}),t.product.renewable?o("q-input",{attrs:{type:"number",filled:"",label:"到期提前出账天数",hint:"设为0则表示该订单不不再出账（已出账的账单不影响），系统默认设定为提前5天"},model:{value:t.info.invoice_days,callback:function(e){t.$set(t.info,"invoice_days",e)},expression:"info.invoice_days"}}):t._e(),t.product.renewable?o("q-input",{attrs:{filled:"",label:"绑定优惠码",hint:"绑定时会进行可用性验证",error:!t.promotionValid},on:{blur:t.promotionCodeCheck},scopedSlots:t._u([{key:"error",fn:function(){return[t._v("\n                  "+t._s(t.promotionMsg)+"\n                ")]},proxy:!0}],null,!1,3944641378),model:{value:t.info.promotion_code,callback:function(e){t.$set(t.info,"promotion_code",e)},expression:"info.promotion_code"}}):t._e(),o("div",[o("q-btn",{attrs:{label:"保存",type:"submit",color:"primary"}})],1)],1)],1)],1)],1),t._l(t.customTabs,(function(e,n){return o("q-tab-panel",{key:n,attrs:{name:n}},[o(e.page,{ref:"customTab",refInFor:!0,tag:"component",attrs:{info:t.info}})],1)}))],2)],1),o("q-inner-loading",{attrs:{showing:!t.loaded}},[o("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1),o("q-dialog",{attrs:{persistent:""},model:{value:t.saveConfirm,callback:function(e){t.saveConfirm=e},expression:"saveConfirm"}},[o("q-card",[o("q-card-section",[o("div",{staticClass:"text-h6"},[t._v("警告")])]),o("q-card-section",{staticClass:"q-pt-none"},[t._v("\n        您输入的优惠码不可用，是否放弃绑定优惠码并保存？\n      ")]),o("q-card-actions",{attrs:{align:"right"}},[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}}),o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"确定",color:"primary"},on:{click:t.order_save}})],1)],1)],1),o("renew-dialog",{ref:"renew",on:{refresh:function(e){return this.loadList({pagination:t.pagination})}}})],1)},i=[],a=(o("7f7f"),o("1c93")),s={base_ss:{manage:function(){return Promise.all([o.e(0),o.e(30)]).then(o.bind(null,"03c9"))},usage:function(){return Promise.all([o.e(0),o.e(9)]).then(o.bind(null,"68b6"))},tabs:{nodes:{title:"查看连接信息",page:function(){return Promise.all([o.e(0),o.e(8)]).then(o.bind(null,"41e4"))}}}},base_v2ray:{manage:function(){return o.e(31).then(o.bind(null,"100f"))},usage:function(){return Promise.all([o.e(0),o.e(11)]).then(o.bind(null,"4106"))},tabs:{nodes:{title:"查看连接信息",page:function(){return Promise.all([o.e(0),o.e(10)]).then(o.bind(null,"d26c"))}}}},node_ss:{manage:function(){return Promise.all([o.e(0),o.e(32)]).then(o.bind(null,"9a5f"))}},node_v2ray:{manage:function(){return Promise.all([o.e(0),o.e(33)]).then(o.bind(null,"f4fc"))}},trf_pkg:{manage:function(){return Promise.all([o.e(0),o.e(34)]).then(o.bind(null,"6ca4"))}},transfer_proxy:{manage:function(){return Promise.all([o.e(0),o.e(12)]).then(o.bind(null,"6a69"))},usage:function(){return o.e(13).then(o.bind(null,"a4d7"))}}},r=o("47f0"),c={data:function(){return{tab:"overview",services:s,info:{},product:{},loaded:!1,manageComponent:null,usageComponent:null,promotionChecking:!1,promotionValid:!0,promotionMsg:null,saveConfirm:!1}},created:function(){this.refresh()},computed:{customTabs:function(){return"active"===this.info.status&&s[this.info.type]?s[this.info.type].tabs:[]},showManageAndUsage:function(){return this.info.type&&s[this.info.type]&&"active"===this.info.status}},methods:{refresh:function(){var t=this;this.$axios.get("/service/"+this.$route.params.id).then((function(e){var o=e.data,n=o.info,i=o.product;t.info=n,t.product=i,t.loaded=!0})),this.$nextTick((function(){var e=t.$refs.manage;e&&e.refresh&&e.refresh();var o=t.$refs.usage;o&&o.refresh&&o.refresh();var n=t.$refs.customTab;for(var i in n){var a=n[i];a&&a.refresh&&a.refresh()}}))},renew:function(){this.$refs.renew.load(this.info.id)},order_save:function(){var t=this;this.promotionChecking?setTimeout((function(){t.order_save()}),500):this.promotionValid||this.saveConfirm?(this.promotionValid||(this.info.promotion_code=null,this.promotionValid=!0),this.$axios.post("/service/saveOrderSettings",{id:this.info.id,data:{name:this.info.name,invoice_days:this.info.invoice_days,promotion:{code:this.info.promotion_code,pid:this.info.pid}}}).then((function(e){e.data.success?t.$q.notify("保存成功"):t.$q.notify(e.data.msg||"保存失败")}))):this.saveConfirm=!0},promotionCodeCheck:function(){var t=this;if(void 0===this.info.promotion_code||null===this.info.promotion_code||""===this.info.promotion_code)return this.promotionChecking=!1,void(this.promotionValid=!0);this.promotionChecking=!0,this.$axios.post("/product/promotion_code/check",{code:this.info.promotion_code,pid:this.info.pid,bind:!0}).then((function(e){t.promotionValid=e.data.success,t.promotionMsg=e.data.success?null:e.data.msg,t.promotionChecking=!1}))}},watch:{"$store.getters.refresh":a["a"],"info.extra.remind":{deep:!0,handler:function(t){if(void 0!==t&&null!==t){var e=parseInt(t);isNaN(e)&&(e=0),this.info.extra.remind=e}}}},components:{RenewDialog:r["a"]}},l=c,d=(o("8a96"),o("2877")),p=o("eebe"),u=o.n(p),f=o("9989"),m=o("429b"),h=o("7460"),v=o("adad"),b=o("823b"),g=o("f09f"),_=o("a370"),q=o("eb85"),C=o("9c40"),y=o("58a8"),k=o("0378"),x=o("27f9"),w=o("74f7"),$=o("cf57"),Q=o("24e8"),T=o("4b7e"),P=o("7f67"),S=Object(d["a"])(l,n,i,!1,null,"07fbf74a",null);e["default"]=S.exports;u()(S,"components",{QPage:f["a"],QTabs:m["a"],QTab:h["a"],QTabPanels:v["a"],QTabPanel:b["a"],QCard:g["a"],QCardSection:_["a"],QSeparator:q["a"],QBtn:C["a"],QBadge:y["a"],QForm:k["a"],QInput:x["a"],QInnerLoading:w["a"],QSpinnerGears:$["a"],QDialog:Q["a"],QCardActions:T["a"]}),u()(S,"directives",{ClosePopup:P["a"]})},c461:function(t,e,o){}}]);