(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[18],{"1c93":function(t,a,e){"use strict";a["a"]={deep:!0,handler:function(t){t&&(this.refresh(),this.$store.dispatch("base/refreshEnd"))}}},"25c6":function(t,a,e){"use strict";a["a"]={alipay:function(){return Promise.all([e.e(0),e.e(28)]).then(e.bind(null,"b2d2"))},test:function(){return e.e(29).then(e.bind(null,"ea90"))}}},9919:function(t,a,e){"use strict";e.r(a);var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-page",{staticClass:"q-pa-md"},[e("q-card",{staticClass:"q-mb-md"},[e("q-card-section",[e("div",{staticClass:"text-h6"},[t._v("充值余额")]),e("div",[t._v("当前余额："+t._s(t.credit))])]),e("q-separator",{attrs:{inset:""}}),e("q-card-section",[e("q-form",{staticClass:"q-gutter-md row inline items-center",on:{submit:t.onSubmit}},[e("q-input",{attrs:{filled:"",dense:"",type:"number",label:"充值金额","lazy-rules":""},model:{value:t.amount,callback:function(a){t.amount=a},expression:"amount"}}),e("q-option-group",{attrs:{options:t.payments,color:"primary",inline:"",dense:""},model:{value:t.payment,callback:function(a){t.payment=a},expression:"payment"}}),e("q-checkbox",{model:{value:t.accept,callback:function(a){t.accept=a},expression:"accept"}},[t._v("\n          我同意御坂网络的\n          "),e("b",[e("router-link",{attrs:{to:"/tos"},scopedSlots:t._u([{key:"default",fn:function(a){var n=a.href,s=a.navigate;return[e("a",{attrs:{href:n,target:"_blank"},on:{click:function(t){return t.stopPropagation(),s(t)}}},[t._v("TOS")])]}}])})],1),t._v("\n          及\n          "),e("b",[e("router-link",{attrs:{to:"/aup"},scopedSlots:t._u([{key:"default",fn:function(a){var n=a.href,s=a.navigate;return[e("a",{attrs:{href:n,target:"_blank"},on:{click:function(t){return t.stopPropagation(),s(t)}}},[t._v("AUP")])]}}])})],1)]),e("div",[e("q-btn",{attrs:{label:"开始支付",type:"submit",color:"primary"}})],1)],1)],1)],1),e("q-table",{attrs:{title:"充值记录",data:t.list,columns:t.columns,"table-style":"max-height: calc(100vh - 80px)","row-key":"id","virtual-scroll":"",pagination:t.pagination,"rows-per-page-options":[10,20,50,100],"no-data-label":"暂无记录",loading:t.loading,dense:t.$q.screen.lt.md,"binary-state-sort":""},on:{"update:pagination":function(a){t.pagination=a},request:t.loadList},scopedSlots:t._u([{key:"top",fn:function(){return[e("div",{staticClass:"q-table__title q-mr-md"},[t._v("充值记录")]),e("q-option-group",{attrs:{options:t.options,color:"green",type:"checkbox",inline:""},model:{value:t.status,callback:function(a){t.status=a},expression:"status"}})]},proxy:!0},{key:"body-cell-gateway",fn:function(a){return[e("q-td",{attrs:{props:a}},[t._v("\n        "+t._s(t._f("paymentName")(a.value))+"\n      ")])]}},{key:"body-cell-amount",fn:function(a){return[e("q-td",{attrs:{props:a}},[t._v("\n        ￥"+t._s(a.value.toFixed(2))+"\n      ")])]}}])}),e("q-dialog",{model:{value:t.paying,callback:function(a){t.paying=a},expression:"paying"}},[e("q-card",[e("q-card-section",[e("div",{staticClass:"text-h6"},[t._v("开始支付")])]),e("q-card-section",{staticClass:"q-pt-none"},[e("p",{staticClass:"text-subtitle1"},[t._v("需支付")]),e("div",{staticClass:"text-h4"},[t._v("￥ "+t._s(t.amountF2))]),t.paying?e(t.paymentComponent,{tag:"component",attrs:{amount:t.amount},on:{finish:t.refresh}}):t._e()],1)],1)],1)],1)},s=[],i=e("25c6"),o=e("1c93"),r={filters:{paymentName:function(t){return window.appConfig.payments[t]}},data:function(){var t=this;return{list:[],loading:!1,loaded:!1,accept:!1,amount:null,payment:null,paying:!1,columns:[{name:"created",label:"创建时间",field:"created",align:"left",sortable:!0,style:"width: 200px",format:function(a,e){return t.$tools.tsmToString(a)}},{name:"gateway",required:!0,label:"支付方式",align:"left",field:"gateway",sortable:!0},{name:"trade_no",label:"交易号",field:"trade_no",align:"left"},{name:"amount",label:"金额",field:"amount",align:"center",sortable:!0},{name:"status",required:!0,label:"状态",align:"left",field:"status",sortable:!0,format:function(a){return t.$tradeStatus[a]}},{name:"finished",label:"付款时间",field:"finished",align:"left",sortable:!0,style:"width: 200px",format:function(a,e){return a?t.$tools.tsmToString(a):"尚未付款"}}],status:[],options:[],pagination:{sortBy:"created",descending:!0,page:1,rowsPerPage:10,rowsNumber:0},credit:0}},created:function(){var t=this,a=!0,e=localStorage.getItem("trade_status_select"),n=[];e?n=JSON.parse(e):a=!1,this.$tradeStatus.forEach((function(e,s){t.options.push({label:e,value:s}),a&&-1===n.indexOf(s)||t.status.push(s)})),localStorage.setItem("trade_status_select",JSON.stringify(this.status)),this.refresh()},methods:{refresh:function(){var t=this;this.$axios.get("/user/credit").then((function(a){t.credit=a.data||0})),this.loadList({pagination:this.pagination})},loadList:function(t){var a=this,e=t.pagination,n=e.page,s=e.rowsPerPage,i=e.sortBy,o=e.descending;this.paying=!1,this.loading=!0,this.showDialog=!1;var r=this.$tools.createListQuery(t.pagination);r.status=this.status,this.$axios.get("/user/pay/list",{params:r}).then((function(t){var e=t.data,r=e.data,l=e.total;a.list=r,a.pagination.rowsNumber=l,a.loading=!1,a.pagination.page=n,a.pagination.rowsPerPage=s,a.pagination.sortBy=i,a.pagination.descending=o,a.loaded=!0}))},onSubmit:function(){this.accept?this.amount<1?this.$q.notify("充值金额必须大于1元"):this.payment?(this.amount=parseFloat(this.amount),this.paying=!0):this.$q.notify("请选择支付方式"):this.$q.notify("请先同意TOS和AUP")}},computed:{payments:function(){var t=[],a=window.appConfig.payments;for(var e in a)t.push({label:a[e],value:e});return t},amountF2:function(){return parseFloat(this.amount).toFixed(2)},paymentComponent:function(){return i["a"][this.payment]}},watch:{"$store.getters.refresh":o["a"],status:function(t,a){this.loaded&&(0!==t.length?(this.refresh(),localStorage.setItem("trade_status_select",JSON.stringify(t))):this.status=a)}}},l=r,u=e("2877"),c=e("eebe"),p=e.n(c),d=e("9989"),f=e("f09f"),m=e("a370"),g=e("eb85"),h=e("0378"),b=e("27f9"),y=e("9f0a"),v=e("8f8e"),_=e("9c40"),q=e("eaac"),w=e("db86"),x=e("24e8"),k=Object(u["a"])(l,n,s,!1,null,"7831f39c",null);a["default"]=k.exports;p()(k,"components",{QPage:d["a"],QCard:f["a"],QCardSection:m["a"],QSeparator:g["a"],QForm:h["a"],QInput:b["a"],QOptionGroup:y["a"],QCheckbox:v["a"],QBtn:_["a"],QTable:q["a"],QTd:w["a"],QDialog:x["a"]})}}]);