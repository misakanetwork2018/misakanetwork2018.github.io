(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{"1c93":function(t,e,i){"use strict";e["a"]={deep:!0,handler:function(t){t&&(this.refresh(),this.$store.dispatch("base/refreshEnd"))}}},a226:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-page",{staticClass:"q-pa-md"},[i("div",{staticClass:"text-h4 text-center"},[t._v(t._s(t.info.title))]),t.loaded?i("div",{staticClass:"ticket chat"},t._l(t.details,(function(e,a){return i("q-chat-message",{key:a,attrs:{name:e.user_id==t.$store.getters.uid?"我":"客服",avatar:e.user_id==t.$store.getters.uid?t.$store.getters.userAvatar:"statics/admin.jpg",text:e.content,stamp:t.$tools.tsmToString(e.time),"text-color":e.user_id==t.$store.getters.uid?"black":"white","bg-color":e.user_id==t.$store.getters.uid?"amber-7":"primary",sent:e.user_id==t.$store.getters.uid}},[[e.attachments.length>0?i("p",[t._v("附件：")]):t._e(),t._l(e.attachments,(function(a,n){return i("p",{key:n},[i("a",{class:e.user_id==t.$store.getters.uid?"text-blue":"text-white",attrs:{href:"javascript:;",id:"attachment-"+a.id},on:{click:function(e){return t.previewAttach(a.id,"image"==a.mime.substring(0,5),e)}}},[t._v(t._s(a.filename))])])}))]],2)})),1):t._e(),i("q-form",{directives:[{name:"show",rawName:"v-show",value:t.loaded,expression:"loaded"}],staticClass:"q-mb-md ticket",on:{submit:t.onSubmit,reset:t.onReset}},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-grow q-mt-md"},[i("q-editor",{ref:"editor",attrs:{"min-height":"10rem",placeholder:"内容",toolbar:[["bold","italic","underline","strike"],["undo","redo"]]},nativeOn:{paste:function(e){return function(e){return t.contentProcess(e)}(e)},drop:function(e){return function(e){return t.contentProcess(e)}(e)}},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}}),i("div",{staticClass:"q-mt-md"},[i("q-btn",{attrs:{label:"提交",type:"submit",color:"primary",disable:t.submitting}}),i("q-btn",{staticClass:"q-ml-sm",attrs:{label:"重置",type:"reset",color:"primary",flat:""}}),i("q-btn",{staticClass:"q-ml-sm",attrs:{label:"关闭工单",color:"red",flat:""},on:{click:t.close}})],1)],1),i("div",{staticClass:"q-gutter-md q-ml-xs q-mt-md",staticStyle:{width:"320px"}},[i("q-uploader",{ref:"uploader",staticStyle:{"max-width":"300px"},attrs:{url:t.uploadUrl,headers:t.uploadHeader,label:"上传附件",multiple:"","auto-upload":"",accept:".jpg,.jpeg,.png,.bmp,.zip,.rar,.7z,.gz"},on:{uploaded:t.uploaded}}),i("p",[t._v("上传后，若要删除附件，请点击“已上传附件列表”在列表中删除附件，上面清空队列是没有用的。")]),i("p",{staticClass:"text-center"},[i("q-btn",{attrs:{flat:"",color:"primary",label:"已上传附件列表"},on:{click:t.showUploaded}})],1)],1)])]),i("div",{attrs:{id:"proxy-none"}}),i("q-popup-proxy",{ref:"preview",attrs:{target:t.previewTarget,"no-parent-event":""}},[t.previewLoading?i("div",{staticStyle:{width:"300px",height:"300px"}}):t._e(),t.previewSuccess?i("img",{style:{width:t.imgWidth+"px",height:t.imgHeigth+"px"},attrs:{src:t.previewUrl},on:{load:function(e){return t.onload(e)}}}):t._e(),t.previewSuccess||t.previewLoading?t._e():i("p",{staticStyle:{padding:"10px"}},[t._v("该附件无法预览，请直接下载")]),i("p",{staticClass:"text-center"},[t.previewLoading?t._e():i("q-btn",{attrs:{label:"下载",flat:"",color:"primary"},on:{click:function(e){return t.downloadAttach(t.previewId)}}})],1),i("q-inner-loading",{attrs:{showing:t.previewLoading}},[i("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1),i("q-dialog",{model:{value:t.showFiles,callback:function(e){t.showFiles=e},expression:"showFiles"}},[i("q-card",[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("已上传文件列表")])]),i("q-card-section",{staticClass:"q-pt-none"},t._l(t.fileList,(function(e,a){return i("div",{key:a},[i("p",[i("q-icon",{attrs:{name:"attach_file"}}),t._v("\n            "+t._s(e.name)+"\n            "),i("q-btn",{attrs:{icon:"delete",round:"",size:"sm",flat:""},on:{click:function(e){return t.deleteAttach(a)}}})],1)])})),0),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"关闭",color:"primary"}})],1)],1)],1),i("q-dialog",{attrs:{persistent:""},model:{value:t.deleting,callback:function(e){t.deleting=e},expression:"deleting"}},[i("q-card",[i("q-card-section",[i("div",{staticClass:"text-h6"},[t._v("警告")])]),i("q-card-section",{staticClass:"row items-center"},[t._v("\n        您打算删除文件 "+t._s(t.fileList[t.deletingId]?t.fileList[t.deletingId].name:"")+" 吗\n      ")]),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"否",color:"primary"}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"是",color:"primary"},on:{click:function(e){return t.deleteAttach(t.deletingId,!0)}}})],1)],1)],1),i("q-inner-loading",{attrs:{showing:!t.loaded}},[i("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1)},n=[],s=(i("34ef"),i("551c"),i("097d"),i("ac6a"),i("cadf"),i("06db"),i("456d"),i("a481"),i("1c93")),r={data:function(){return{form:{content:"",files:[]},info:{},details:{},loaded:!1,width:"",imgWidth:"",imgHeigth:"",reply:!1,timeout:null,previewTarget:"#proxy-none",previewId:0,previewUrl:null,previewLoading:!1,previewSuccess:!1,fileList:{},showFiles:!1,deleting:!1,deletingId:0,submitting:!1}},created:function(){this.refresh()},methods:{refresh:function(){var t=this;this.$axios.get("/ticket/"+this.$route.params.id).then((function(e){var i=e.data,a=i.info,n=i.details;t.info=a,t.details=n,t.loaded=!0}))},onSubmit:function(){var t=this;this.submitting=!0,""!==this.form.content.replace(/<[^<>]+>/g,"")?(this.form.files=Object.keys(this.fileList),this.$axios.post("/ticket/reply/"+this.info.id,this.form).then((function(e){t.$q.notify({message:"回复成功",color:"green",position:"top"}),t.submitting=!1,t.refresh(),t.onReset()})).catch((function(){t.$q.notify({message:"提交失败，请重试",color:"red",position:"top"})}))):this.$q.notify({message:"请输入内容",color:"orange",position:"center"})},onReset:function(){this.form={content:"",files:[]},this.$refs.uploader.reset()},contentProcess:function(t){var e,i;t.preventDefault(),t.originalEvent&&t.originalEvent.clipboardData.getData?(e=t.originalEvent.clipboardData.getData("text/plain"),this.$refs.editor.runCmd("insertText",e)):t.clipboardData&&t.clipboardData.getData?(e=t.clipboardData.getData("text/plain"),this.$refs.editor.runCmd("insertText",e)):window.clipboardData&&window.clipboardData.getData&&(i||(i=!0,this.$refs.editor.runCmd("ms-pasteTextOnly",e)),i=!1)},uploaded:function(t){var e=t.files,i=t.xhr,a=JSON.parse(i.response)[0];this.fileList[a]=e[0]},close:function(){var t=this;this.$axios.post("/ticket/close",{id:this.info.id}).then((function(){t.$router.push("/ticket")})).catch((function(){t.$q.notify({message:"关闭失败，请重试",color:"red",position:"top"})}))},downloadAttach:function(t){var e=this;this.$q.notify({message:"开始下载，大文件需要较长时间下载，请勿重复操作<br>提示：上方有加载进度条，请根据进度条状态判断下载进度",html:!0}),this.$axios.get("/download/"+t,{responseType:"blob"}).then((function(t){e.$tools.download(t.data,t.headers.filename,t.headers["content-type"])})).catch((function(){e.$q.notify({message:"下载失败，请重试",color:"red",position:"top"})}))},previewAttach:function(t,e,i){var a=this;this.previewSuccess=!1,this.previewUrl=null,this.previewId=t,this.previewTarget="#"+i.target.id,this.$refs.preview.show(),e&&(this.previewLoading=!0,this.$axios.get("/download/"+t,{responseType:"arraybuffer"}).then((function(t){a.previewSuccess=!0,a.previewUrl="data:image/png;base64,"+btoa(new Uint8Array(t.data).reduce((function(t,e){return t+String.fromCharCode(e)}),""))})).catch((function(){a.previewSuccess=!1})).finally((function(){a.previewLoading=!1})))},onload:function(t){var e=t.target.naturalWidth,i=t.target.naturalHeight,a=700;e<a&&i<this.winHeight-251?(this.width=e+50,this.imgWidth=e,this.imgHeigth=i):(a-50)/(this.winHeight-251)<=e/i?(this.width=a,this.imgHeigth=(a-50)/(e/i),this.imgWidth=a-50):(this.imgWidth=(this.winHeight-251)*(e/i),this.width=this.imgWidth+50,this.imgHeigth=this.winHeight-255)},showUploaded:function(){this.showFiles=!0},deleteAttach:function(t,e){var i=this;e?this.$axios.post("/file/delete/"+t).then((function(){i.$q.notify("已删除"),i.$delete(i.fileList,t)})).catch((function(){i.$q.notify("删除失败")})):(this.deletingId=t,this.deleting=!0)}},components:{},computed:{uploadUrl:function(){return window.appConfig.apiUrl+"/upload"},uploadHeader:function(){return[{name:"Authorization",value:"Bearer ".concat(this.$store.getters.authToken)}]},winWidth:function(){return document.documentElement.clientWidth||document.body.clientWidth},winHeight:function(){return document.documentElement.clientHeight||document.body.clientHeight}},watch:{"$store.getters.refresh":s["a"]}},o=r,c=(i("e6e8"),i("2877")),l=i("eebe"),d=i.n(l),p=i("9989"),u=i("8169"),h=i("0378"),f=i("d66b"),g=i("9c40"),m=i("ee89"),v=i("7cbe"),w=i("74f7"),b=i("cf57"),q=i("24e8"),y=i("f09f"),x=i("a370"),$=i("0016"),_=i("4b7e"),C=i("7f67"),k=Object(c["a"])(o,a,n,!1,null,"88d6ecf8",null);e["default"]=k.exports;d()(k,"components",{QPage:p["a"],QChatMessage:u["a"],QForm:h["a"],QEditor:f["a"],QBtn:g["a"],QUploader:m["a"],QPopupProxy:v["a"],QInnerLoading:w["a"],QSpinnerGears:b["a"],QDialog:q["a"],QCard:y["a"],QCardSection:x["a"],QIcon:$["a"],QCardActions:_["a"]}),d()(k,"directives",{ClosePopup:C["a"]})},dd60:function(t,e,i){},e6e8:function(t,e,i){"use strict";var a=i("dd60"),n=i.n(a);n.a}}]);